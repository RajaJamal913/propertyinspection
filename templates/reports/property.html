<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Report - {{ property.address }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  
<style>
  :root {
    --primary: #1a4f72;
    --secondary: #6c757d;
    --light: #f8fafc;
    --dark: #343a40;
    --accent: #1e88e5;
    --success: #28a745;
    --warning: #ffc107;
    --border: #e2e8f0;
    --gallery-image-size: 140px;
    --thumbnail-size: 100px;
    --display-image-size: 140px;
    --gallery-cols: 4;
}

/* Base */
body {
    background: #f8fafc;
    color: #334155;
    font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    line-height: 1.6;
}

.report-container {
    max-width: 1200px;
    margin: 2rem auto;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    overflow: hidden;
}

.report-header {
    background: linear-gradient(135deg, var(--primary) 0%, #0d3a5d 100%);
    color: white;
    padding: 2rem 3rem;
    position: relative;
}

.header-content { position: relative; z-index: 2; }

.header-pattern {
    position: absolute; top: 0; right: 0; bottom: 0; left: 0;
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%231a4f72"/><path d="M0 50 L100 50 M50 0 L50 100" stroke="%231d5680" stroke-width="1" stroke-opacity="0.3"/></svg>');
    opacity: 0.15;
}

/* Cards / Sections */
.section-card {
    background: white;
    border-radius: 10px;
    border: 1px solid var(--border);
    margin-bottom: 1.5rem;
    overflow: hidden;
    page-break-inside: avoid;
}

.section-header {
    background: #f1f5f9;
    border-bottom: 1px solid var(--border);
    padding: 1.25rem 1.5rem;
    font-weight: 600;
    color: var(--primary);
    font-size: 1.1rem;
    display: flex;
    align-items: center;
}

.section-icon {
    background: rgba(30, 136, 229, 0.1);
    width: 36px; height: 36px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    margin-right: 12px; color: var(--accent);
}

.section-body { padding: 1.5rem; }

/* Summary grid */
.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin: 1.5rem 0;
}

.summary-item {
    background: white;
    border-radius: 10px;
    padding: 1.25rem;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
}

.summary-icon { font-size: 1.75rem; margin-bottom: 0.75rem; color: var(--accent); }
.summary-count { font-size: 1.75rem; font-weight: 700; color: var(--primary); margin-bottom: 0.25rem; }
.summary-label { color: var(--secondary); font-size: 0.9rem; }

/* Sub-section styling */
.sub-section {
    margin-bottom: 2rem;
}

.sub-section-header {
    font-weight: 600;
    color: var(--primary);
    font-size: 1.1rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
}

.badge-count {
    background: var(--accent);
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    margin-left: 0.5rem;
}

/* Details organization */
.details-section {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border);
}

.details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
    margin-bottom: 0.5rem;
}

.detail-item {
    padding: 0.75rem 1rem;
    background: #f8fafc;
    border-radius: 6px;
    border-left: 3px solid var(--accent);
    transition: all 0.2s ease;
}

.detail-item:hover {
    background: #f0f5fa;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}

.detail-item-label {
    font-size: 0.8rem;
    color: var(--primary);
    margin-bottom: 0.3rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.4px;
}

.detail-item-value {
    font-weight: 500;
    color: var(--dark);
    font-size: 0.95rem;
    word-break: break-word;
}

/* Component organization */
.component-container {
    background: white;
    border: 1px solid var(--border);
    border-radius: 10px;
    margin-bottom: 1.5rem;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    transition: all 0.3s ease;
    page-break-inside: avoid;
}

.component-container:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    border-color: var(--accent);
}

.component-photos {
    width: 100%;
    background: linear-gradient(135deg, #f8fafc 0%, #f0f5fa 100%);
    padding: 1.25rem;
    border-bottom: 1px solid var(--border);
}

.component-details {
    padding: 1.5rem;
    background: #fafbfc;
}

.component-title {
    font-weight: 700;
    color: var(--primary);
    font-size: 1.05rem;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
}

/* ---------- IMAGE GALLERY: CLEAN 4-COLUMN LAYOUT ---------- */

/* Main photo gallery - consistent 4 columns */
.photo-gallery, .sub-entity-gallery {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin-top: 1rem;
    margin-bottom: 1.5rem;
    padding: 0;
    border-radius: 8px;
    background: transparent;
}

/* Card layout for gallery items */
.photo-item, .sub-entity-photo {
    width: 100%;
    height: var(--gallery-image-size);
    position: relative;
    overflow: hidden;
    border-radius: 6px;
    border: 1px solid #dee2e6;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
}

.photo-item img, .sub-entity-photo img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

/* Photo labels - clean overlay */
.photo-label, .sub-entity-label {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 8px 6px;
    font-size: 0.75rem;
    text-align: center;
    line-height: 1.2;
    white-space: normal;
    overflow: hidden;
    text-overflow: ellipsis;
    display: none; /* HIDE LABELS */
    -webkit-box: none;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

/* Display tile variants */
.photo-display-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0;
    margin-top: 0.5rem;
    justify-content: stretch;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    overflow: hidden;
}

.photo-display-item {
    flex: 0 0 calc(50% - 0px);
    max-width: calc(50% - 0px);
    position: relative;
    page-break-inside: avoid;
    background: #f8f9fa;
    border-radius: 4px;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: var(--display-image-size);
    min-height: var(--display-image-size);
    margin: 0;
    border: 1px solid #e9ecef;
}

.photo-display-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border: none;
    border-radius: 0;
}

.photo-placeholder {
    height: var(--gallery-image-size);
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f9fa;
    border: 1px dashed #dee2e6;
    border-radius: 8px;
    color: #6c757d;
    flex-direction: column;
    width: var(--gallery-image-size);
    margin: 0 auto;
}

.photo-placeholder i { font-size: 2rem; margin-bottom: 0.5rem; }

/* Thumbnail container used in tables */
.thumbnail-container {
    width: var(--thumbnail-size);
    height: var(--thumbnail-size);
    position: relative;
    background: #f8f9fa;
    padding: 0;
    border-radius: 4px;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0 auto;
    border: 1px solid #e9ecef;
}

.thumbnail-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 0;
    border: none;
}

/* Room & Utility specifics */
.room-card {
    background: #f8fafc;
    border-radius: 10px;
    border: 1px solid var(--border);
    margin-bottom: 1.5rem;
    overflow: hidden;
    page-break-inside: avoid;
}

.room-header {
    background: #e6f0ff;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border);
    font-weight: 600;
    color: var(--primary);
    display: flex;
    align-items: center;
}

.room-icon { margin-right: 10px; color: var(--accent); }

/* Room header colors - different colors for each room */
.room-card:nth-child(1) .room-header { background: #e3f2fd; color: #1565c0; }
.room-card:nth-child(2) .room-header { background: #f3e5f5; color: #6a1b9a; }
.room-card:nth-child(3) .room-header { background: #e8f5e9; color: #2e7d32; }
.room-card:nth-child(4) .room-header { background: #fff3e0; color: #e65100; }
.room-card:nth-child(5) .room-header { background: #fce4ec; color: #c2185b; }
.room-card:nth-child(6) .room-header { background: #e0f2f1; color: #00695c; }
.room-card:nth-child(7) .room-header { background: #f1f8e9; color: #558b2f; }
.room-card:nth-child(n+8) .room-header { background: #ede7f6; color: #512da8; }

.utility-card {
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.25rem;
    margin-bottom: 1.5rem;
    page-break-inside: avoid;
}

.utility-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.utility-type { font-weight: 600; color: var(--primary); font-size: 1.1rem; }

.utility-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
}

.utility-detail {
    padding: 0.75rem;
    background: #f8fafc;
    border-radius: 6px;
}

.detail-label { font-size: 0.85rem; color: var(--secondary); margin-bottom: 0.25rem; }
.detail-value { font-weight: 500; }

/* Signature & Footer */
.signature-section {
    border-top: 2px dashed var(--border);
    padding-top: 2rem;
    margin-top: 2rem;
    page-break-inside: avoid;
}

.signature-header { font-weight: 600; color: var(--primary); margin-bottom: 1.5rem; text-align: center; }

.signature-container {
    display: flex; justify-content: space-around; flex-wrap: wrap; gap: 2rem; margin-bottom: 2rem;
}

.signature-box { flex: 1; min-width: 300px; max-width: 400px; }

.signature-label { font-weight: 500; margin-bottom: 0.5rem; color: var(--dark); }

.signature-pad {
    width: 100%;
    height: 150px;
    border: 2px solid var(--border);
    border-radius: 8px;
    background: white;
    cursor: crosshair;
    touch-action: none;
    display: block;
}

.signature-actions { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
.signature-btn { flex: 1; }

.signature-preview {
    width: 100%;
    height: 150px;
    border: 1px dashed var(--border);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f9fa;
    overflow: hidden;
}

.signature-preview img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.signature-date { font-size: 0.9rem; color: var(--secondary); text-align: center; margin-top: 0.5rem; }
.signature-name { font-weight: 500; text-align: center; margin-top: 0.5rem; color: var(--primary); }

/* Misc */
.data-table { width: 100%; border-collapse: separate; border-spacing: 0; }
.data-table th {
    background: #f8fafc;
    padding: 0.85rem 1rem;
    text-align: left;
    font-weight: 600;
    color: var(--primary);
    border-bottom: 2px solid var(--border);
}
.data-table td { padding: 0.75rem 1rem; border-bottom: 1px solid var(--border); vertical-align: top; }
.data-table tr:last-child td { border-bottom: none; }

.kv { font-weight: 600; width: 35%; color: #475569; }
.val { color: #1e293b; }

.intro-section {
    background: #f0f8ff;
    border-left: 4px solid var(--accent);
    border-radius: 0 8px 8px 0;
    page-break-inside: avoid;
    margin-bottom: 1.5rem;
    padding: 1.5rem !important;
}

.intro-section .row {
    gap: 1rem !important;
}

.intro-card {
    background: white;
    border-radius: 8px;
    border: 1px solid var(--border);
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    height: 100%;
    transition: transform 0.3s ease;
    page-break-inside: avoid;
    display: flex;
    flex-direction: column;
}

.intro-card:hover { transform: translateY(-5px); }

.intro-card-body {
    flex: 1;
}

.intro-card-header {
    background: #e6f2ff;
    padding: 0.9rem;
    font-weight: 600;
    color: var(--primary);
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center;
    font-size: 1rem;
}

.intro-icon {
    background: rgba(30, 136, 229, 0.15);
    width: 32px; height: 32px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    margin-right: 8px; color: var(--accent);
    flex-shrink: 0;
}

.intro-card-body { 
    padding: 1rem;
    font-size: 0.9rem;
    line-height: 1.5;
    word-break: break-word;
    overflow-wrap: break-word;
    word-wrap: break-word;
}

.intro-card-body ul {
    list-style-position: inside;
    margin: 0;
    margin-bottom: 0;
    padding-left: 1.2rem;
    overflow-wrap: break-word;
}

.intro-card-body li {
    margin-bottom: 0.4rem;
    word-break: break-word;
    overflow-wrap: break-word;
    display: list-item;
}

.intro-card-body p {
    margin-bottom: 0.8rem;
    word-break: break-word;
    overflow-wrap: break-word;
}

.intro-card-body p:last-child {
    margin-bottom: 0;
}

.intro-title {
    font-weight: 700; 
    margin-bottom: 1.2rem;
    margin-top: 0;
    color: var(--primary);
    border-bottom: 2px solid var(--accent); 
    padding-bottom: 0.5rem; 
    display: block;
    font-size: 1.3rem;
}

.disclaimer-box {
    background: #fff8e6;
    border: 1px solid #ffecb3;
    border-radius: 8px;
    padding: 1.25rem;
    margin-top: 1.5rem;
    page-break-inside: avoid;
}

.disclaimer-header { font-weight: 600; color: #e65100; display: flex; align-items: center; margin-bottom: 0.75rem; }

.print-btn {
    background: white;
    color: var(--primary);
    border: none;
    border-radius: 8px;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    display: inline-flex;
    align-items: center;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s ease;
}

.print-btn:hover {
    background: #f0f5fa;
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    color: var(--primary);
}

.print-btn i { margin-right: 8px; }

.footer {
    text-align: center;
    padding: 2rem;
    color: var(--secondary);
    border-top: 1px solid var(--border);
    background: #f8fafc;
    page-break-before: avoid;
}

/* Responsive adjustments */
@media (max-width: 1200px) {
    .photo-gallery, .sub-entity-gallery {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 768px) {
    :root {
        --gallery-image-size: 150px;
        --thumbnail-size: 100px;
        --display-image-size: 150px;
    }
    
    .photo-gallery, .sub-entity-gallery {
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
    }
    
    .details-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 0.5rem;
    }

    .intro-card-body {
        font-size: 0.9rem;
        padding: 1rem;
    }

    .intro-card-body ul {
        list-style-position: inside;
        margin: 0 !important;
        padding-left: 0.5rem !important;
        overflow-wrap: break-word !important;
    }

    .intro-card-body li {
        word-break: break-word;
        overflow-wrap: break-word;
        margin-bottom: 0.3rem !important;
        display: list-item !important;
        padding-left: 0.5rem !important;
    }

    .intro-card {
        margin-bottom: 1rem;
    }
}

@media (max-width: 576px) {
    .row.g-4 {
        gap: 1rem !important;
    }

    .intro-card-body {
        font-size: 0.85rem;
        padding: 0.75rem;
    }

    .intro-card-header {
        padding: 0.75rem;
    }

    .intro-card-body ul {
        list-style: disc;
        list-style-position: inside;
        margin: 0;
        padding-left: 0.5rem;
    }

    .intro-card-body li {
        margin-bottom: 0.25rem;
        line-height: 1.4;
        word-break: break-word;
        overflow-wrap: break-word;
        padding-left: 0.25rem;
    }

    .p-4, .p-lg-5 {
        padding: 1rem !important;
    }

    .text-end {
        text-align: right;
    }

    .print-btn {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
        margin-left: 0.5rem;
    }

    .ms-2 {
        margin-left: 0.5rem !important;
    }
}

/* ENHANCED PRINT STYLES */
@media print {
    :root {
        --gallery-image-size: 120px !important;
        --thumbnail-size: 80px !important;
        --display-image-size: 130px !important;
    }

    * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }

    html, body { 
        height: auto !important; 
        overflow: visible !important;
        margin: 0 !important;
        padding: 0 !important;
        background: white !important;
    }

    .report-container { 
        box-shadow: none !important; 
        margin: 0 !important; 
        border: none !important; 
        border-radius: 0 !important; 
        width: 100% !important; 
        max-width: 100% !important; 
        overflow: visible !important;
        page-break-after: avoid !important;
    }

    .no-print, .no-print * { display: none !important; visibility: hidden !important; }

    .report-header {
        background: var(--primary) !important; 
        color: white !important;
        padding: 1.5rem !important; 
        position: relative !important; 
        page-break-after: avoid !important;
        page-break-inside: avoid !important;
    }

    .header-pattern { display: none !important; }

    .intro-section { 
        background: #f0f8ff !important; 
        border-left: 4px solid var(--accent) !important; 
        padding: 1rem !important; 
        page-break-inside: avoid !important; 
        page-break-after: auto !important;
        margin: 0 !important;
        margin-bottom: 0.8rem !important;
    }

    .intro-section .row {
        display: grid !important;
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 0.5rem !important;
    }

    .intro-title {
        font-size: 1.1rem !important;
        margin-bottom: 0.8rem !important;
        margin-top: 0 !important;
        padding-bottom: 0.4rem !important;
        display: block !important;
    }

    .intro-card { 
        border: 1px solid #ddd !important; 
        box-shadow: none !important; 
        margin: 0 !important;
        padding: 0 !important;
        page-break-inside: avoid !important;
        background: white !important;
        break-inside: avoid !important;
        display: flex !important;
        flex-direction: column !important;
        height: auto !important;
    }

    .intro-card-header { 
        background: #e6f2ff !important; 
        border-bottom: 1px solid #ddd !important; 
        padding: 0.7rem !important;
        font-size: 0.9rem !important;
        font-weight: 600 !important;
        display: flex !important;
        align-items: center !important;
    }

    .intro-card-body {
        padding: 0.7rem !important;
        font-size: 0.85rem !important;
        line-height: 1.4 !important;
        flex: 1 !important;
        margin: 0 !important;
    }

    .intro-card-body p {
        margin-bottom: 0.5rem !important;
    }

    .intro-card-body p:last-child {
        margin-bottom: 0 !important;
    }

    .intro-card-body ul {
        list-style: disc !important;
        list-style-position: inside !important;
        margin: 0 !important;
        padding-left: 1.1rem !important;
    }

    .intro-card-body li {
        margin-bottom: 0.3rem !important;
        line-height: 1.3 !important;
    }

    .intro-icon {
        width: 26px !important;
        height: 26px !important;
        margin-right: 0.5rem !important;
        flex-shrink: 0 !important;
    }

    .disclaimer-box { 
        background: #fff8e6 !important; 
        border: 1px solid #ffecb3 !important; 
        padding: 0.8rem !important; 
        page-break-inside: avoid !important;
        margin: 0.8rem 0 !important;
        font-size: 0.85rem !important;
        line-height: 1.5 !important;
    }

    .disclaimer-header {
        font-size: 0.9rem !important;
        font-weight: 600 !important;
        margin-bottom: 0.5rem !important;
    }

    .disclaimer-box p {
        margin-bottom: 0 !important;
    }

    .section-card { 
        box-shadow: none !important; 
        border: 1px solid #ddd !important; 
        margin-bottom: 1rem !important; 
        page-break-inside: avoid !important;
        background: white !important;
    }

    .section-header { 
        background: #f1f5f9 !important; 
        border-bottom: 1px solid #ddd !important; 
        padding: 0.8rem 1rem !important;
        page-break-inside: avoid !important;
    }

    .section-body {
        padding: 1rem !important;
    }

    .print-btn { display: none !important; visibility: hidden !important; }

    .summary-grid { 
        grid-template-columns: repeat(3, 1fr) !important; 
        gap: 0.5rem !important; 
        margin: 1rem 0 !important; 
    }

    .summary-item { 
        padding: 0.8rem !important; 
        border: 1px solid #ddd !important; 
        box-shadow: none !important; 
        page-break-inside: avoid !important;
        background: white !important;
    }

    .photo-gallery, .sub-entity-gallery {
        display: grid !important;
        grid-template-columns: repeat(4, 1fr) !important;
        gap: 6px !important;
        grid-auto-rows: auto !important;
        break-inside: avoid !important;
        page-break-inside: avoid !important;
        border-radius: 4px !important;
        overflow: hidden !important;
    }

    .photo-item, .sub-entity-photo {
        width: 100% !important;
        height: var(--gallery-image-size) !important;
        min-height: var(--gallery-image-size) !important;
        page-break-inside: avoid !important;
        break-inside: avoid !important;
        border-radius: 4px !important;
        border: 1px solid #ddd !important;
    }

    .photo-item img, .sub-entity-photo img {
        width: 100% !important;
        height: 100% !important;
        max-width: 100% !important;
        max-height: 100% !important;
        object-fit: cover !important;
    }

    .photo-display-container {
        display: flex !important;
        flex-wrap: wrap !important;
        break-inside: avoid !important;
        page-break-inside: avoid !important;
        gap: 0 !important;
        border: 1px solid #ddd !important;
        border-radius: 4px !important;
        overflow: hidden !important;
    }

    .photo-display-item {
        flex: 0 0 calc(33.333% - 0px) !important;
        max-width: calc(33.333% - 0px) !important;
        height: var(--display-image-size) !important;
        min-height: var(--display-image-size) !important;
        page-break-inside: avoid !important;
        break-inside: avoid !important;
        margin: 0 !important;
        border: 1px solid #ddd !important;
    }

    .photo-display-item img {
        width: 100% !important;
        height: 100% !important;
        max-width: 100% !important;
        max-height: 100% !important;
        object-fit: cover !important;
    }

    .thumbnail-container { 
        width: var(--thumbnail-size) !important; 
        height: var(--thumbnail-size) !important; 
        border: 1px solid #ddd !important; 
    }

    .thumbnail-container img { 
        width: 100% !important; 
        height: 100% !important; 
        max-width: 100% !important; 
        max-height: 100% !important; 
    }

    .component-container {
        box-shadow: none !important;
        border: 1px solid #ddd !important;
        margin-bottom: 1rem !important;
        page-break-inside: avoid !important;
        break-inside: avoid !important;
    }

    .component-details {
        padding: 0.75rem !important;
        background: white !important;
    }

    .component-photos {
        padding: 0.75rem !important;
        border-top: 1px solid #ddd !important;
        page-break-inside: avoid !important;
    }

    .detail-item {
        padding: 0.5rem 0.75rem !important;
        background: #f8fafc !important;
        border-left: 3px solid var(--accent) !important;
        margin-bottom: 0.5rem !important;
    }

    .detail-item-label {
        font-size: 0.75rem !important;
        font-weight: 700 !important;
        margin-bottom: 0.2rem !important;
    }

    .detail-item-value {
        font-size: 0.85rem !important;
        color: #334155 !important;
    }

    .sub-section {
        page-break-inside: avoid !important;
        margin-bottom: 1rem !important;
    }

    .sub-section-header {
        background: #f1f5f9 !important;
        padding: 0.6rem 0.8rem !important;
        margin-bottom: 0.8rem !important;
        border-bottom: 1px solid #ddd !important;
        font-size: 0.95rem !important;
    }

    .data-table { 
        width: 100% !important;
        border-collapse: collapse !important;
        page-break-inside: auto !important;
    }

    .data-table th, .data-table td { 
        padding: 0.5rem !important; 
        font-size: 11pt !important;
        border: 1px solid #ddd !important;
    }

    .data-table th {
        background: #f1f5f9 !important;
        font-weight: 600 !important;
    }

    .room-card { 
        margin-bottom: 1rem !important; 
        page-break-inside: avoid !important;
        border: 1px solid #ddd !important;
        background: white !important;
    }

    .summary-count, .section-header, .room-header, .sub-section-header, .badge-count { 
        color: inherit !important;
    }

    .text-primary, .text-success, .text-warning, .text-danger, .text-info, .text-secondary, .text-muted { 
        color: inherit !important;
    }

    img { 
        max-width: 100% !important; 
        max-height: 100% !important; 
        height: auto !important; 
        object-fit: cover !important; 
        page-break-inside: avoid !important;
    }

    .p-4, .p-lg-5 { 
        padding: 1rem !important; 
    }

    .utility-card { 
        border: 1px solid #ddd !important; 
        padding: 1rem !important; 
        margin-bottom: 1rem !important; 
        page-break-inside: avoid !important;
        background: white !important;
    }

    .utility-details { 
        grid-template-columns: repeat(2, 1fr) !important; 
    }

    .component-container {
        page-break-inside: avoid !important;
        border: 1px solid #ddd !important;
        margin-bottom: 1rem !important;
    }

    .sub-section {
        page-break-inside: avoid !important;
        margin-bottom: 1rem !important;
    }

    .sub-section-header {
        background: #f1f5f9 !important;
        page-break-inside: avoid !important;
    }

    .signature-section { 
        border-top: 2px dashed #ddd !important; 
        padding-top: 1rem !important; 
        page-break-inside: avoid !important;
        page-break-before: auto !important;
    }

    .signature-pad { 
        border: 1px solid #000 !important;
        height: 120px !important;
        width: 100% !important;
        display: block !important;
        background: white !important;
    }

    .signature-header {
        display: block !important;
    }

    .signature-label { 
        display: none !important; 
    }

    .signature-print-label {
        display: block !important;
        font-weight: 600 !important;
        color: #1e293b !important;
        margin-bottom: 0.5rem !important;
        text-align: center !important;
    }

    .signature-actions { 
        display: none !important; 
    }

    .signature-preview { 
        display: none !important;
    }

    .signature-preview img { 
        max-height: 90px !important; 
        object-fit: contain !important; 
    }

    .signature-name {
        display: none !important;
    }

    .signature-date {
        display: none !important;
    }

    .signature-container {
        display: flex !important;
        justify-content: space-around !important;
        gap: 2rem !important;
    }

    .signature-box {
        flex: 1 !important;
        min-width: 200px !important;
    }

    .alert.alert-info {
        display: none !important;
    }

    .alert {
        page-break-inside: avoid !important;
        border: 1px solid #ddd !important;
    }

    table { 
        page-break-inside: auto !important;
        width: 100% !important;
    }

    tr { 
        page-break-inside: avoid !important; 
        page-break-after: auto !important; 
    }

    .photo-label { 
        font-size: 8pt !important; 
        padding: 3px !important; 
        height: auto !important; 
        line-height: 1.1 !important; 
    }

    a[href]::after { 
        content: none !important; 
    }

    @page { 
        margin: 0.3cm !important;
        size: A4 !important;
    }

    /* Prevent orphaned text at page boundaries */
    body { orphans: 3 !important; widows: 3 !important; }
    
    p, li, h1, h2, h3, h4, h5, h6 { 
        orphans: 2 !important; 
        widows: 2 !important; 
        page-break-inside: avoid !important;
    }

    /* Prevent unnecessary page breaks in sections */
    .component-container, .subsection { 
        page-break-inside: avoid !important;
        break-inside: avoid !important;
        margin-bottom: 0.5rem !important;
    }

    /* Adjust spacing to fit more content per page */
    .report-header { margin-bottom: 0.5rem !important; }
    .intro-section { margin-bottom: 0.5rem !important; padding: 1rem !important; }
    .intro-card { margin-bottom: 0.5rem !important; padding: 0.6rem !important; }
    .section-card { margin-bottom: 0.5rem !important; }
    .summary-item { padding: 0.6rem !important; margin-bottom: 0.3rem !important; }
    
    /* Reduce padding where possible */
    .section-header { padding: 0.6rem 0.8rem !important; }
    .section-body { padding: 0.8rem !important; }
}

/* Small utility: remove hairline artifacts if seen */
.photo-gallery, .photo-gallery * { -webkit-backface-visibility: hidden; -webkit-transform: translateZ(0); transform: translateZ(0); }

</style>
</head>
<body>
    <div class="report-container">
        <!-- Report Header -->
        <div class="report-header">
            <div class="header-pattern"></div>
            <div class="header-content">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h1 class="h2 mb-3">LetCheck Ltd Inventory & Schedule of condition </h1>
                        <h2 class="h4 mb-2">{{ property.address }}</h2>
                        <p class="mb-0 opacity-75">{{ now|date:"F j, Y" }}</p>
                    </div>
                    
                    <div class="text-end no-print">
                        <button class="print-btn" id="downloadBtn" type="button" onclick="window.print()">
                            <i class="bi bi-download"></i> Download Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- About This Report Section -->
        <div class="p-4 p-lg-5 intro-section">
            <h3 class="intro-title">
                <i class="bi bi-info-circle me-2"></i>About This Inventory Report
            </h3>
            
            <div class="row g-4">
                <!-- Card 1: What is this report? -->
                <div class="col-md-6 col-lg-4">
                    <div class="intro-card">
                        <div class="intro-card-header">
                            <div class="intro-icon">
                                <i class="bi bi-file-earmark-text"></i>
                            </div>
                            What is this Report?
                        </div>
                        <div class="intro-card-body">
                            <p>The LetCheck Ltd Property Inventory Report provides an accurate, impartial record of the property's condition.</p>
                            <p class="mb-0">It documents both the overall state of the premises and the condition of individual items where applicable.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Card 2: Why is it valuable? -->
                <div class="col-md-6 col-lg-4">
                    <div class="intro-card">
                        <div class="intro-card-header">
                            <div class="intro-icon">
                                <i class="bi bi-shield-check"></i>
                            </div>
                            Why is it Valuable?
                        </div>
                        <div class="intro-card-body">
                            <p>This report is essential for avoiding deposit disputes at the end of a tenancy.</p>
                            <p class="mb-0">Official guidance recommends independent inventory services to record the property's state at both start and end of the rental period.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Card 3: Who can use it? -->
                <div class="col-md-6 col-lg-4">
                    <div class="intro-card">
                        <div class="intro-card-header">
                            <div class="intro-icon">
                                <i class="bi bi-people"></i>
                            </div>
                            Who Can Use This?
                        </div>
                        <div class="intro-card-body">
                            <p>As an impartial report from an independent provider, it can be relied upon by:</p>
                            <ul class="mb-0">
                                <li>Landlords</li>
                                <li>Tenants</li>
                                <li>Letting Agents</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Card 4: What's included? -->
                <div class="col-md-6 col-lg-4">
                    <div class="intro-card">
                        <div class="intro-card-header">
                            <div class="intro-icon">
                                <i class="bi bi-check-circle"></i>
                            </div>
                            What's Included?
                        </div>
                        <div class="intro-card-body">
                            <ul>
                                <li>Room-by-room breakdown of condition</li>
                                <li>Documented defects with photos</li>
                                <li>Items not mentioned are assumed in good condition</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Card 5: What's not covered? -->
                <div class="col-md-6 col-lg-4">
                    <div class="intro-card">
                        <div class="intro-card-header">
                            <div class="intro-icon">
                                <i class="bi bi-x-circle"></i>
                            </div>
                            What's Not Covered?
                        </div>
                        <div class="intro-card-body">
                            <ul>
                                <li>Safety compliance assessments</li>
                                <li>Structural soundness checks</li>
                                <li>Valuation or building survey</li>
                                <li>Personal belongings or valuables</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Card 6: Inspection scope -->
                <div class="col-md-6 col-lg-4">
                    <div class="intro-card">
                        <div class="intro-card-header">
                            <div class="intro-icon">
                                <i class="bi bi-search"></i>
                            </div>
                            Inspection Scope
                        </div>
                        <div class="intro-card-body">
                            <p><strong>Includes:</strong> Visible areas of main building, accessible outbuildings and gardens</p>
                            <p class="mb-0"><strong>Excludes:</strong> Common areas in flats, roof spaces, locked areas, and overfilled storage spaces</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Disclaimer Box -->
            <div class="disclaimer-box">
                <div class="disclaimer-header">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    Important Disclaimer
                </div>
                <p class="mb-0">Every effort has been made to ensure the accuracy of this inventory; however, LetCheck Ltd cannot guarantee absolute accuracy.
It is the responsibility of both the landlord and tenant to review this document carefully and confirm its correctness by signing below.

This report records the furniture, furnishings, and landlord-owned items present in the property on the date of inspection. It does not provide a guarantee of adequacy, safety, or compliance — it simply confirms the existence and observed condition of these items at the time of the inventory.

By signing this document, the undersigned agree that, subject to any notes or amendments, it represents a fair and accurate record of the property's condition and contents.

The tenant and/or landlord has seven (7) days from receipt of this report to notify the landlord, agent or LetCheck Ltd of any discrepancies.</p>
            </div>
        </div>
        
        <!-- Report Content -->
        <div class="p-4 p-lg-5">
            <!-- Cleaning Standard -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-brush"></i>
                    </div>
                    Cleaning Standard
                </div>
                <div class="section-body">
                    <p style="margin: 0; font-size: 0.95rem; line-height: 1.6;">This property has been cleaned to a good standard unless indicated else where on the inventory report.</p>
                </div>
            </div>

            <!-- Property Details -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-info-circle"></i>
                    </div>
                    Property Details
                </div>
                <div class="section-body">
                    <table class="table table-borderless mb-0">
                        <tr>
                            <td class="fw-medium text-muted" width="30%">Address</td>
                            <td>{{ property.address }}</td>
                        </tr>
                        <tr>
                            <td class="fw-medium text-muted">Postcode</td>
                            <td>{{ property.postcode }}</td>
                        </tr>
                        <tr>
                            <td class="fw-medium text-muted">Property Type</td>
                            <td>{{ property.propertyType }}</td>
                        </tr>
                        <tr>
                            <td class="fw-medium text-muted">Detachment</td>
                            <td>{{ property.detachment }}</td>
                        </tr>
                        <tr>
                            <td class="fw-medium text-muted">Inspected By</td>
                            <td>{{ inspected_by }}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Front View -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-camera"></i>
                    </div>
                    Front View
                </div>
                <div class="section-body">
                    {% if front_photos %}
                    <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                        {% for url in front_photos %}
                            {% if url %}
                            <div style="flex: 0 1 calc(33.333% - 8px); min-width: 200px;">
                                <img src="{{ url }}" alt="Front View" style="width: 100%; height: auto; border-radius: 6px; border: 1px solid #e2e8f0;">
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-image text-muted" style="font-size: 2.5rem;"></i>
                        <p class="text-muted mt-3">No front view photos available</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Other Views -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-camera2"></i>
                    </div>
                    Other Views
                </div>
                <div class="section-body">
                    {% if other_views %}
                    <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                        {% for url in other_views %}
                            {% if url %}
                            <div style="flex: 0 1 calc(33.333% - 8px); min-width: 200px;">
                                <img src="{{ url }}" alt="Other View" style="width: 100%; height: auto; border-radius: 6px; border: 1px solid #e2e8f0;">
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-image text-muted" style="font-size: 2.5rem;"></i>
                        <p class="text-muted mt-3">No other view photos available</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Summary Section -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-clipboard-data"></i>
                    </div>
                    Property Summary
                </div>
                <div class="section-body">
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-icon text-primary">
                                <i class="bi bi-people"></i>
                            </div>
                            <div class="summary-count">{{ tenant_count }}</div>
                            <div class="summary-label">Tenants</div>
                        </div>
                        
                        <div class="summary-item">
                            <div class="summary-icon text-info">
                                <i class="bi bi-lightning-charge"></i>
                            </div>
                            <div class="summary-count">{% if utility %}1{% else %}0{% endif %}</div>
                            <div class="summary-label">Utilities</div>
                        </div>
                        
                        <div class="summary-item">
                            <div class="summary-icon text-warning">
                                <i class="bi bi-alarm"></i>
                            </div>
                            <div class="summary-count">{{ detector_count }}</div>
                            <div class="summary-label">Detectors</div>
                        </div>
                        
                        <div class="summary-item">
                            <div class="summary-icon text-danger">
                                <i class="bi bi-key"></i>
                            </div>
                            <div class="summary-count">{{ key_count }}</div>
                            <div class="summary-label">Keys</div>
                        </div>
                        
                        <div class="summary-item">
                            <div class="summary-icon text-secondary">
                                <i class="bi bi-files"></i>
                            </div>
                            <div class="summary-count">{{ document_count }}</div>
                            <div class="summary-label">Documents</div>
                        </div>
                        
                        <div class="summary-item">
                            <div class="summary-icon text-success">
                                <i class="bi bi-door-open"></i>
                            </div>
                            <div class="summary-count">{{ total_rooms }}</div>
                            <div class="summary-label">Rooms</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tenants -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-people"></i>
                    </div>
                    Tenants
                    <span class="badge-count">{{ tenant_count }}</span>
                </div>
                <div class="section-body">
                    {% if property.tenantDetails %}
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Contact</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for t in property.tenantDetails %}
                            <tr>
                                <td>{{ t.tenantName }}</td>
                                <td>
                                    <div>{{ t.mobilePhone }}</div>
                                    <div class="small text-primary">
                                        <a href="mailto:{{ t.tenantEmail }}">{{ t.tenantEmail }}</a>
                                    </div>
                                </td>
                                <td>{{ t.notes|default:"—" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-person-x text-muted fs-1"></i>
                        <p class="text-muted mt-2">No tenants recorded</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Utilities -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-lightning-charge"></i>
                    </div>
                    Utilities ({{ meters_count }})
                </div>
                <div class="section-body">
                    {% if utility %}
                        <!-- Gas Meter -->
                        <div class="sub-section mb-4">
                            <div class="sub-section-header">
                                <i class="bi bi-lightning-charge me-2"></i>
                                Gas Meter
                            </div>
                            <div class="component-container">
                                <div class="component-details">
                                    <div class="details-grid">
                                        <div class="detail-item">
                                            <div class="detail-item-label">Serial Number</div>
                                            <div class="detail-item-value">{{ utility.gasMeterSerialNumber|default:"—" }}</div>
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-item-label">Reading</div>
                                            <div class="detail-item-value">{{ utility.gasMeterReading|default:"—" }}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="component-photos">
                                    <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                    {% if utility.gasMeterPhoto %}
                                        <div class="photo-gallery">
                                            {% for p in utility.gasMeterPhoto %}
                                            <div class="photo-item">
                                                <img src="{{ p }}" alt="Gas meter photo">
                                                <div class="photo-label">Gas Meter</div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Electricity Meter -->
                        <div class="sub-section mb-4">
                            <div class="sub-section-header">
                                <i class="bi bi-lightning-charge me-2"></i>
                                Electricity Meter
                            </div>
                            <div class="component-container">
                                <div class="component-details">
                                    <div class="details-grid">
                                        <div class="detail-item">
                                            <div class="detail-item-label">Serial Number</div>
                                            <div class="detail-item-value">{{ utility.electricityMeterSerialNumber|default:"—" }}</div>
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-item-label">Reading</div>
                                            <div class="detail-item-value">{{ utility.electricityMeterReading|default:"—" }}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="component-photos">
                                    <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                    {% if utility.electricityMeterPhoto %}
                                        <div class="photo-gallery">
                                            {% for p in utility.electricityMeterPhoto %}
                                            <div class="photo-item">
                                                <img src="{{ p }}" alt="Electricity meter photo">
                                                <div class="photo-label">Electricity Meter</div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Water Meter -->
                        {% if utility.waterMeterReading or utility.waterMeterSerialNumber or utility.waterMeterPhoto %}
                        <div class="sub-section mb-4">
                            <div class="sub-section-header">
                                <i class="bi bi-water me-2"></i>
                                Water Meter
                            </div>
                            <div class="component-container">
                                <div class="component-details">
                                    <div class="details-grid">
                                        <div class="detail-item">
                                            <div class="detail-item-label">Serial Number</div>
                                            <div class="detail-item-value">{{ utility.waterMeterSerialNumber|default:"—" }}</div>
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-item-label">Reading</div>
                                            <div class="detail-item-value">{{ utility.waterMeterReading|default:"—" }}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="component-photos">
                                    <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                    {% if utility.waterMeterPhoto %}
                                        <div class="photo-gallery">
                                            {% for p in utility.waterMeterPhoto %}
                                            <div class="photo-item">
                                                <img src="{{ p }}" alt="Water meter photo">
                                                <div class="photo-label">Water Meter</div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Heat Meter -->
                        {% if utility.heatMeterReading or utility.heatMeterSerialNumber or utility.heatMeterPhoto %}
                        <div class="sub-section mb-4">
                            <div class="sub-section-header">
                                <i class="bi bi-fire me-2"></i>
                                Heat Meter
                            </div>
                            <div class="component-container">
                                <div class="component-details">
                                    <div class="details-grid">
                                        <div class="detail-item">
                                            <div class="detail-item-label">Serial Number</div>
                                            <div class="detail-item-value">{{ utility.heatMeterSerialNumber|default:"—" }}</div>
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-item-label">Reading</div>
                                            <div class="detail-item-value">{{ utility.heatMeterReading|default:"—" }}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="component-photos">
                                    <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                    {% if utility.heatMeterPhoto %}
                                        <div class="photo-gallery">
                                            {% for p in utility.heatMeterPhoto %}
                                            <div class="photo-item">
                                                <img src="{{ p }}" alt="Heat meter photo">
                                                <div class="photo-label">Heat Meter</div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Other Meter -->
                        {% if utility.otherMeterType or utility.otherMeterReading or utility.otherMeterSerialNumber or utility.otherMeterPhoto %}
                        <div class="sub-section mb-4">
                            <div class="sub-section-header">
                                <i class="bi bi-lightning-charge me-2"></i>
                                {{ utility.otherMeterType }} Meter
                            </div>
                            <div class="component-container">
                                <div class="component-details">
                                    <div class="details-grid">
                                        <div class="detail-item">
                                            <div class="detail-item-label">Serial Number</div>
                                            <div class="detail-item-value">{{ utility.otherMeterSerialNumber|default:"—" }}</div>
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-item-label">Reading</div>
                                            <div class="detail-item-value">{{ utility.otherMeterReading|default:"—" }}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="component-photos">
                                    <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                    {% if utility.otherMeterPhoto %}
                                        <div class="photo-gallery">
                                            {% for p in utility.otherMeterPhoto %}
                                            <div class="photo-item">
                                                <img src="{{ p }}" alt="Other meter photo">
                                                <div class="photo-label">{{ utility.otherMeterType }}</div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Stopcock -->
                        <div class="sub-section mb-4">
                            <div class="sub-section-header">
                                <i class="bi bi-water me-2"></i>
                                Stopcock
                            </div>
                            <div class="component-container">
                                <div class="component-details">
                                    <div class="details-grid">
                                        <div class="detail-item">
                                            <div class="detail-item-label">Location</div>
                                            <div class="detail-item-value">{{ utility.stopcokLocation|default:"—" }}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="component-photos">
                                    <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                    {% if utility.stopcokPhoto %}
                                        <div class="photo-gallery">
                                            {% for p in utility.stopcokPhoto %}
                                            <div class="photo-item">
                                                <img src="{{ p }}" alt="Stopcock photo">
                                                <div class="photo-label">Stopcock</div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Fusebox -->
                        <div class="sub-section mb-4">
                            <div class="sub-section-header">
                                <i class="bi bi-lightning me-2"></i>
                                Fusebox
                            </div>
                            <div class="component-container">
                                <div class="component-details">
                                    <div class="details-grid">
                                        <div class="detail-item">
                                            <div class="detail-item-label">Location</div>
                                            <div class="detail-item-value">{{ utility.fuseboxLocation|default:"—" }}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="component-photos">
                                    <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                    {% if utility.fuseboxPhoto %}
                                        <div class="photo-gallery">
                                            {% for p in utility.fuseboxPhoto %}
                                            <div class="photo-item">
                                                <img src="{{ p }}" alt="Fusebox photo">
                                                <div class="photo-label">Fusebox</div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-plug text-muted" style="font-size: 2.5rem;"></i>
                        <p class="text-muted mt-3">No utilities recorded</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Detectors -->
{% if property.detectors and property.detectors|length > 0 %}
<!-- Detectors Section - Simplified -->
<div class="section-card">
    <div class="section-header">
        <div class="section-icon">
            <i class="bi bi-alarm"></i>
        </div>
        Detectors
        <span class="badge-count">{{ detector_count }}</span>
    </div>
    <div class="section-body">
        
        <!-- Smoke Detectors Table -->
        <div class="sub-section mb-4">
            <div class="sub-section-header">
                <i class="bi bi-alarm me-2"></i>
                Smoke Detectors
            </div>
            
            {% with smoke_detectors=property.detectors|dictsort:"detectorType" %}
            {% if property.detectors and property.detectors|length > 0 %}
                {% if property.detectors|dictsort:"detectorType"|first %}
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Present</th>
                            <th>Working</th>
                            <th>Location</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for d in property.detectors %}
                            {% if d.detectorType == 'Smoke' or d.type == 'smoke' %}
                            <tr>
                                <td>{% if d.detectorPresent %}Yes{% else %}N/A{% endif %}</td>
                                <td>{% if d.working %}Yes{% else %}N/A{% endif %}</td>
                                <td>{{ d.location|default:"—" }}</td>
                                <td>{{ d.notes|default:"—" }}</td>
                            </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="text-center py-3">
                    <p class="text-muted">No smoke detectors recorded</p>
                </div>
                {% endif %}
            {% endif %}
            {% endwith %}
        </div>

        <!-- Carbon Monoxide Detectors Table -->
        <div class="sub-section mb-4">
            <div class="sub-section-header">
                <i class="bi bi-exclamation-triangle me-2"></i>
                Carbon Monoxide Detectors
            </div>
            
            {% if property.detectors and property.detectors|length > 0 %}
                {% if property.detectors|dictsort:"detectorType" %}
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Present</th>
                            <th>Working</th>
                            <th>Location</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for d in property.detectors %}
                            {% if d.detectorType == 'CO' or d.type == 'co' %}
                            <tr>
                                <td>{% if d.detectorPresent %}Yes{% else %}N/A{% endif %}</td>
                                <td>{% if d.working %}Yes{% else %}N/A{% endif %}</td>
                                <td>{{ d.location|default:"—" }}</td>
                                <td>{{ d.notes|default:"—" }}</td>
                            </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="text-center py-3">
                    <p class="text-muted">No carbon monoxide detectors recorded</p>
                </div>
                {% endif %}
            {% endif %}
        </div>

        <!-- Heat Detectors Table -->
        <div class="sub-section mb-4">
            <div class="sub-section-header">
                <i class="bi bi-fire me-2"></i>
                Heat Detectors
            </div>
            
            {% if property.detectors and property.detectors|length > 0 %}
                {% if property.detectors|dictsort:"detectorType" %}
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Present</th>
                            <th>Working</th>
                            <th>Location</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for d in property.detectors %}
                            {% if d.detectorType == 'Heat' or d.type == 'heat' %}
                            <tr>
                                <td>{% if d.detectorPresent %}Yes{% else %}N/A{% endif %}</td>
                                <td>{% if d.working %}Yes{% else %}N/A{% endif %}</td>
                                <td>{{ d.location|default:"—" }}</td>
                                <td>{{ d.notes|default:"—" }}</td>
                            </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="text-center py-3">
                    <p class="text-muted">No heat detectors recorded</p>
                </div>
                {% endif %}
            {% endif %}
        </div>
        
        <!-- Detector Compliance -->
        {% if property.detectorCompliance %}
        <div class="sub-section">
            <div class="sub-section-header">
                <i class="bi bi-check2-circle me-2"></i>
                Detector Compliance Status
            </div>
            <table class="table table-borderless">
                <tr>
                    <td class="kv">Smoke Alarm Compliance</td>
                    <td class="val">{% if property.detectorCompliance.smokeAlarmCompliance %}Yes{% else %}N/A{% endif %}</td>
                </tr>
                <tr>
                    <td class="kv">Carbon Monoxide Compliance</td>
                    <td class="val">{% if property.detectorCompliance.carbonMonoxideCompliance %}Yes{% else %}N/A{% endif %}</td>
                </tr>
            </table>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}
            
            <!-- Keys -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-key"></i>
                    </div>
                    Keys
                    <span class="badge-count">{{ key_count }}</span>
                </div>
                <div class="section-body">
                    {% if property.keys %}
                        {% for k in property.keys %}
                        <div class="component-container">
                            <div class="component-details">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-item-label">Description</div>
                                        <div class="detail-item-value">{{ k.description }}</div>
                                    </div>
                                    {% if k.notes %}
                                    <div class="detail-item">
                                        <div class="detail-item-label">Notes</div>
                                        <div class="detail-item-value">{{ k.notes }}</div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="component-photos">
                                <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                {% if k.photo %}
                                    <div class="photo-gallery">
                                        {% for photo_url in k.photo %}
                                        <div class="photo-item">
                                            <img src="{{ photo_url }}" alt="Key photo">
                                            <div class="photo-label">{{ k.description }}</div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-key text-muted" style="font-size: 2.5rem;"></i>
                        <p class="text-muted mt-3">No keys recorded</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Documents -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-files"></i>
                    </div>
                    Documents
                    <span class="badge-count">{{ document_count }}</span>
                </div>
                <div class="section-body">
                    {% if property.documents %}
                        {% for doc in property.documents %}
                        <div class="component-container">
                            <div class="component-details">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-item-label">Description</div>
                                        <div class="detail-item-value">{{ doc.description }}</div>
                                    </div>
                                    {% if doc.notes %}
                                    <div class="detail-item">
                                        <div class="detail-item-label">Notes</div>
                                        <div class="detail-item-value">{{ doc.notes }}</div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="component-photos">
                                <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                {% if doc.photo %}
                                    <div class="photo-gallery">
                                        {% for photo_url in doc.photo %}
                                        <div class="photo-item">
                                            <img src="{{ photo_url }}" alt="Document photo">
                                            <div class="photo-label">{{ doc.description }}</div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-file-earmark-x text-muted" style="font-size: 2.5rem;"></i>
                        <p class="text-muted mt-3">No documents recorded</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- ROOMS SECTION -->
            <h2 style="margin-top: 2rem; margin-bottom: 1rem; padding: 1rem; background: linear-gradient(135deg, #1a4f72 0%, #0d3a5d 100%); color: white; border-radius: 8px; font-size: 1.5rem; font-weight: 600;"><i class="bi bi-house-door me-2"></i>Rooms</h2>
            
            {% if property.rooms %}
                {% for r in property.rooms %}
                {% cycle '#e6f2ff' '#f3e5f5' '#e8f5e9' '#fff3e0' '#fce4ec' '#e0f2f1' '#f1f8e9' '#ede7f6' as bg_color silent %}
                {% cycle '#1a4f72' '#6a1b9a' '#2e7d32' '#e65100' '#c2185b' '#00695c' '#558b2f' '#512da8' as text_color silent %}
                {% cycle '#1e88e5' '#9c27b0' '#4caf50' '#ff9800' '#e91e63' '#009688' '#8bc34a' '#673ab7' as border_color silent %}
                <h3 style="margin-top: 1.5rem; margin-bottom: 0.8rem; padding: 0.8rem 1rem; background: {{ bg_color }}; color: {{ text_color }}; border-left: 4px solid {{ border_color }}; font-size: 1.2rem; font-weight: 600;">
                    <i class="bi bi-house-door me-2"></i>{{ r.roomType }}
                    {% if r.overviewComments %}<span class="badge bg-success ms-2">{{ r.overviewComments }}</span>{% endif %}
                </h3>
                                <!-- Room Notes -->
                                {% if r.notes|length > 0 %}
                                <div class="alert alert-info mb-4">
                                    <i class="bi bi-info-circle me-2"></i>
                                    <strong>Room Notes:</strong> {{ r.notes }}
                                </div>
                                {% endif %}
                                {% if r.photo %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-images me-2"></i>
                                        Room Overview
                                    </div>
                                    <div class="photo-gallery">
                                        {% for photo_url in r.photo %}
                                        <div class="photo-item">
                                            <img src="{{ photo_url }}" alt="Room overview">
                                            <div class="photo-label">Room Overview</div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Doors Section -->
                                {% if r.doors %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-door-closed me-2"></i>
                                        Doors
                                        <span class="badge-count">{{ r.doors|length }}</span>
                                    </div>
                                    {% for d in r.doors %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Finish</div>
                                                    <div class="detail-item-value">{{ d.doorFinish }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Color</div>
                                                    <div class="detail-item-value">{{ d.doorColour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Frame Type</div>
                                                    <div class="detail-item-value">{{ d.frameType }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Frame Color</div>
                                                    <div class="detail-item-value">{{ d.frameColour }}</div>
                                                </div>
                                                {% if d.features %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Features</div>
                                                    <div class="detail-item-value">{{ d.features }}</div>
                                                </div>
                                                {% endif %}
                                                {% if d.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ d.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title">{{ d.doorType }} - {{ d.condition }}</div>
                                            {% if d.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in d.photo %}
                                                    <div class="photo-item">
                                                        <img src="{{ photo_url }}" alt="Door photo">
                                                        <div class="photo-label">{{ d.doorType }}</div>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Windows Section -->
                                {% if r.windows %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-window me-2"></i>
                                        Windows
                                        <span class="badge-count">{{ r.windows|length }}</span>
                                    </div>
                                    {% for w in r.windows %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Glass Type</div>
                                                    <div class="detail-item-value">{{ w.glassType }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Frame Type</div>
                                                    <div class="detail-item-value">{{ w.frameType }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Sill Type</div>
                                                    <div class="detail-item-value">{{ w.sillType }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Frame Color</div>
                                                    <div class="detail-item-value">{{ w.frameColour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Sill Color</div>
                                                    <div class="detail-item-value">{{ w.sillColour }}</div>
                                                </div>
                                                {% if w.features %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Features</div>
                                                    <div class="detail-item-value">{{ w.features }}</div>
                                                </div>
                                                {% endif %}
                                                {% if w.openers %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Openers</div>
                                                    <div class="detail-item-value">{{ w.openers }}</div>
                                                </div>
                                                {% endif %}
                                                {% if w.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ w.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title">{{ w.windowType }} - {{ w.condition }}</div>
                                            {% if w.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in w.photo %}
                                                    <div class="photo-item">
                                                        <img src="{{ photo_url }}" alt="Window photo">
                                                        <div class="photo-label">{{ w.windowType }}</div>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Ceilings Section -->
                                {% if r.ceilings %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-square me-2"></i>
                                        Ceilings
                                        <span class="badge-count">{{ r.ceilings|length }}</span>
                                    </div>
                                    {% for c in r.ceilings %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Color</div>
                                                    <div class="detail-item-value">{{ c.colour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Fittings</div>
                                                    <div class="detail-item-value">{{ c.ceilingFittings }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Recessed Spotlights</div>
                                                    <div class="detail-item-value">{{ c.recessedSpotlights }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Bulbs Not Working</div>
                                                    <div class="detail-item-value">{{ c.bulbsNotWorking }}</div>
                                                </div>
                                                {% if c.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ c.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title">{{ c.ceilingFinish }} - {{ c.condition }}</div>
                                            {% if c.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in c.photo %}
                                                    <div class="photo-item">
                                                        <img src="{{ photo_url }}" alt="Ceiling photo">
                                                        <div class="photo-label">{{ c.ceilingFinish }}</div>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Floors Section -->
                                {% if r.floors %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-border-width me-2"></i>
                                        Floors
                                        <span class="badge-count">{{ r.floors|length }}</span>
                                    </div>
                                    {% for f in r.floors %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Color</div>
                                                    <div class="detail-item-value">{{ f.colour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Additions</div>
                                                    <div class="detail-item-value">{{ f.additions|default:"—" }}</div>
                                                </div>
                                                {% if f.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ f.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title">{{ f.floorFinish }} - {{ f.condition }}</div>
                                            {% if f.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in f.photo %}
                                                    <div class="photo-item">
                                                        <img src="{{ photo_url }}" alt="Floor photo">
                                                        <div class="photo-label">{{ f.floorFinish }}</div>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Walls Section -->
                                {% if r.walls %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-border-left me-2"></i>
                                        Walls
                                        <span class="badge-count">{{ r.walls|length }}</span>
                                    </div>
                                    {% for w in r.walls %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Color</div>
                                                    <div class="detail-item-value">{{ w.colour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Skirting Type</div>
                                                    <div class="detail-item-value">{{ w.skirtingType }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Skirting Color</div>
                                                    <div class="detail-item-value">{{ w.skirtingColour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Features</div>
                                                    <div class="detail-item-value">{{ w.features|default:"—" }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Signs of Leakages</div>
                                                    <div class="detail-item-value">{{ w.signOfLeakages|yesno:"Yes,No" }}</div>
                                                </div>
                                                {% if w.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ w.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title">{{ w.description }} - {{ w.condition }}</div>
                                            {% if w.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in w.photo %}
                                                    <div class="photo-item">
                                                        <img src="{{ photo_url }}" alt="Wall photo">
                                                        <div class="photo-label">{{ w.description }}</div>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Fixtures & Fittings Section -->
                                {% if r.fixturesFittings %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-lightning me-2"></i>
                                        Fixtures & Fittings
                                        <span class="badge-count">{{ r.fixturesFittings|length }}</span>
                                    </div>
                                    {% for f in r.fixturesFittings %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Light Switches</div>
                                                    <div class="detail-item-value">{{ f.lightSwitches }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Plug Sockets</div>
                                                    <div class="detail-item-value">{{ f.plugSockets }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Radiators</div>
                                                    <div class="detail-item-value">{{ f.radiators }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Light Fittings</div>
                                                    <div class="detail-item-value">{{ f.lightFittings }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Toilets</div>
                                                    <div class="detail-item-value">{{ f.toilets }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Basins</div>
                                                    <div class="detail-item-value">{{ f.basins }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Light Tested</div>
                                                    <div class="detail-item-value">{{ f.lightTested|yesno:"Yes,No" }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Sockets Tested</div>
                                                    <div class="detail-item-value">{{ f.plugSocketsTested|yesno:"Yes,No" }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Switches Safe</div>
                                                    <div class="detail-item-value">{{ f.electricSwitchesVisuallySafe|yesno:"Yes,No" }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Sockets Safe</div>
                                                    <div class="detail-item-value">{{ f.plugSocketsVisuallySafe|yesno:"Yes,No" }}</div>
                                                </div>
                                                {% if f.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ f.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title">{{ f.fixture }}</div>
                                            {% if f.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in f.photo %}
                                                    <div class="photo-item">
                                                        <img src="{{ photo_url }}" alt="Fixture photo">
                                                        <div class="photo-label">{{ f.fixture }}</div>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Furnishings Section -->
                                {% if r.furnishings %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-sofa me-2"></i>
                                        Furnishings
                                        <span class="badge-count">{{ r.furnishings|length }}</span>
                                    </div>
                                    {% for furn in r.furnishings %}
                                    <div class="component-container">
                                        {% if furn.notes %}
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ furn.notes }}</div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                        <div class="component-photos">
                                            <div class="component-title">{{ furn.furnishings }}</div>
                                            {% if furn.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in furn.photo %}
                                                    <div class="photo-item">
                                                        <img src="{{ photo_url }}" alt="Furnishing photo">
                                                        <div class="photo-label">{{ furn.furnishings }}</div>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Cupboards Section -->
                                {% if r.cupboards %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-archive me-2"></i>
                                        Cupboards
                                        <span class="badge-count">{{ r.cupboards|length }}</span>
                                    </div>
                                    {% for cup in r.cupboards %}
                                    <div class="component-container">
                                        {% if cup.notes %}
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ cup.notes }}</div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                        <div class="component-photos">
                                            <div class="component-title">{{ cup.cupboardContent }}</div>
                                            {% if cup.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in cup.photo %}
                                                    <div class="photo-item">
                                                        <img src="{{ photo_url }}" alt="Cupboard photo">
                                                        <div class="photo-label">{{ cup.cupboardContent }}</div>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Kitchen Appliances Section -->
                                {% if r.kitchenAppliances %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-refrigerator me-2"></i>
                                        Kitchen Appliances
                                        <span class="badge-count">{{ r.kitchenAppliances|length }}</span>
                                    </div>
                                    {% for a in r.kitchenAppliances %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Type</div>
                                                    <div class="detail-item-value">{{ a.kitchenAppliances }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Condition</div>
                                                    <div class="detail-item-value">{{ a.condition }}</div>
                                                </div>
                                                {% if a.brand %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Brand</div>
                                                    <div class="detail-item-value">{{ a.brand }}</div>
                                                </div>
                                                {% endif %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Color</div>
                                                    <div class="detail-item-value">{{ a.colour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Quantity</div>
                                                    <div class="detail-item-value">{{ a.quantity }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Tested</div>
                                                    <div class="detail-item-value">{{ a.tested|yesno:"Yes,No" }}</div>
                                                </div>
                                                {% if a.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ a.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title"><i class="bi bi-image\"></i> Photos</div>
                                            {% if a.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in a.photo %}
                                                    <div class="photo-item">
                                                        <img src="{{ photo_url }}" alt="Appliance photo">
                                                        <div class="photo-label">{{ a.kitchenAppliances }}</div>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}
                {% endfor %}
            {% else %}
                <div class="text-center py-4">
                    <i class="bi bi-door-closed text-muted fs-1"></i>
                    <p class="text-muted mt-2">No rooms recorded</p>
                </div>
            {% endif %}

            <!-- External Surfaces -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-house-exclamation"></i>
                    </div>
                    External Surfaces
                    <span class="badge-count">{{ external_features_count }}</span>
                </div>
                <div class="section-body">
                    {% if property.externalSurfaces %}
                        {% for s in property.externalSurfaces %}
                        <div class="component-container">
                            <div class="component-details">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-item-label">Location</div>
                                        <div class="detail-item-value">{{ s.location }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-item-label">Type</div>
                                        <div class="detail-item-value">{{ s.externalSurfaceType }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-item-label">Condition</div>
                                        <div class="detail-item-value">{{ s.condition }}</div>
                                    </div>
                                    {% if s.notes %}
                                    <div class="detail-item">
                                        <div class="detail-item-label">Notes</div>
                                        <div class="detail-item-value">{{ s.notes }}</div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="component-photos">
                                <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                {% if s.photo %}
                                    <div class="photo-gallery">
                                        {% for photo_url in s.photo %}
                                        <div class="photo-item">
                                            <img src="{{ photo_url }}" alt="External surface photo">
                                            <div class="photo-label">{{ s.externalSurfaceType }}</div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-house-exclamation text-muted" style="font-size: 2.5rem;"></i>
                        <p class="text-muted mt-3">No external surfaces recorded</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- External Features -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-tree"></i>
                    </div>
                    External Features
                    <span class="badge-count">{{ external_features_count }}</span>
                </div>
                <div class="section-body">
                    {% if property.externalFeatures %}
                        {% for f in property.externalFeatures %}
                        <div class="component-container">
                            <div class="component-details">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-item-label">Feature</div>
                                        <div class="detail-item-value">{{ f.externalFeature }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-item-label">Condition</div>
                                        <div class="detail-item-value">{{ f.condition }}</div>
                                    </div>
                                    {% if f.notes %}
                                    <div class="detail-item">
                                        <div class="detail-item-label">Notes</div>
                                        <div class="detail-item-value">{{ f.notes }}</div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="component-photos">
                                <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                {% if f.photo %}
                                    <div class="photo-gallery">
                                        {% for photo_url in f.photo %}
                                        <div class="photo-item">
                                            <img src="{{ photo_url }}" alt="External feature photo">
                                            <div class="photo-label">{{ f.externalFeature }}</div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-tree text-muted" style="font-size: 2.5rem;"></i>
                        <p class="text-muted mt-3">No external features recorded</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Boundaries -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-fence"></i>
                    </div>
                    Boundaries
                    <span class="badge-count">{{ boundaries_count }}</span>
                </div>
                <div class="section-body">
                    {% if property.boundary %}
                        {% for b in property.boundary %}
                        <div class="component-container">
                            <div class="component-details">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-item-label">Type</div>
                                        <div class="detail-item-value">{{ b.boundaryType }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-item-label">Color</div>
                                        <div class="detail-item-value">{{ b.colour }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-item-label">Condition</div>
                                        <div class="detail-item-value">{{ b.condition }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-item-label">Quantity</div>
                                        <div class="detail-item-value">{{ b.quantity }}</div>
                                    </div>
                                    {% if b.notes %}
                                    <div class="detail-item">
                                        <div class="detail-item-label">Notes</div>
                                        <div class="detail-item-value">{{ b.notes }}</div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="component-photos">
                                <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                {% if b.photo %}
                                    <div class="photo-gallery">
                                        {% for photo_url in b.photo %}
                                        <div class="photo-item">
                                            <img src="{{ photo_url }}" alt="Boundary photo">
                                            <div class="photo-label">{{ b.boundaryType }}</div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-fence text-muted" style="font-size: 2.5rem;"></i>
                        <p class="text-muted mt-3">No boundaries recorded</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Signature Section -->
            <div class="signature-section">
                <h4 class="signature-header">
                    <i class="bi bi-pen me-2"></i>
                    Signatures
                </h4>
                
                <div class="signature-container">
                    <!-- Landlord Signature -->
                    <div class="signature-box">
                        <div class="signature-label">Landlord/Agent Signature</div>
                        <div class="signature-print-label">Landlord / Agent</div>
                        <canvas class="signature-pad" id="landlord-signature-pad"></canvas>
                        <div class="signature-actions">
                            <button class="btn btn-secondary signature-btn" id="landlord-clear">Clear</button>
                            <button class="btn btn-primary signature-btn" id="landlord-save">Save Signature</button>
                        </div>
                        <div class="signature-preview" id="landlord-preview">
                            <span class="text-muted">Signature will appear here</span>
                        </div>
                        <div class="signature-name">Landlord / Agent: _________________________</div>
                        <div class="signature-date" id="landlord-date"></div>
                    </div>

                    <!-- Tenant Signature -->
                    <div class="signature-box">
                        <div class="signature-label">Tenant Signature</div>
                        <div class="signature-print-label">Tenant</div>
                        <canvas class="signature-pad" id="tenant-signature-pad"></canvas>
                        <div class="signature-actions">
                            <button class="btn btn-secondary signature-btn" id="tenant-clear">Clear</button>
                            <button class="btn btn-primary signature-btn" id="tenant-save">Save Signature</button>
                        </div>
                        <div class="signature-preview" id="tenant-preview">
                            <span class="text-muted">Signature will appear here</span>
                        </div>
                        <div class="signature-name">Tenant: _________________________</div>
                        <div class="signature-date" id="tenant-date"></div>
                    </div>
                </div>
                
                <div class="alert alert-info mt-4">
                    <i class="bi bi-info-circle me-2"></i> 
                    By signing this document, you acknowledge that you have reviewed and agree with the contents of this property inventory report.
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                <div class="d-flex align-items-center justify-content-center mb-2">
                    <div class="bg-primary rounded-circle p-2 me-3"></div>
                    <div class="bg-info rounded-circle p-2 me-3"></div>
                    <div class="bg-success rounded-circle p-2"></div>
                </div>
                <div class="small">Property Full Report • Generated on {{ now|date:"M j, Y" }}</div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Elements (canvas)
      let landlordCanvas = document.getElementById('landlord-signature-pad');
      let tenantCanvas = document.getElementById('tenant-signature-pad');

      // Helper: set canvas pixel size for high-DPI and preserve drawing when needed
      function setCanvasDisplaySize(canvas) {
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        // set the internal pixel size to match display size * ratio
        canvas.width = Math.floor(canvas.offsetWidth * ratio);
        canvas.height = Math.floor(canvas.offsetHeight * ratio);
        // scale drawing operations to account for ratio
        canvas.getContext('2d').setTransform(ratio, 0, 0, ratio, 0, 0);
      }

      // Initial sizing BEFORE creating SignaturePad
      setCanvasDisplaySize(landlordCanvas);
      setCanvasDisplaySize(tenantCanvas);

      // Create SignaturePad instances
      const landlordSignaturePad = new SignaturePad(landlordCanvas, {
        backgroundColor: 'rgb(255, 255, 255)',
        penColor: 'rgb(0, 0, 0)'
      });

      const tenantSignaturePad = new SignaturePad(tenantCanvas, {
        backgroundColor: 'rgb(255, 255, 255)',
        penColor: 'rgb(0, 0, 0)'
      });

      // Buttons
      document.getElementById('landlord-clear').addEventListener('click', function() {
        landlordSignaturePad.clear();
        document.getElementById('landlord-preview').innerHTML = `<span class="text-muted">Signature will appear here</span>`;
        document.getElementById('landlord-date').textContent = '';
      });

      document.getElementById('tenant-clear').addEventListener('click', function() {
        tenantSignaturePad.clear();
        document.getElementById('tenant-preview').innerHTML = `<span class="text-muted">Signature will appear here</span>`;
        document.getElementById('tenant-date').textContent = '';
      });

      document.getElementById('landlord-save').addEventListener('click', function() {
        if (landlordSignaturePad.isEmpty()) {
          alert("Please provide a signature first.");
          return;
        }
        const dataURL = landlordSignaturePad.toDataURL();
        document.getElementById('landlord-preview').innerHTML = `<img src="${dataURL}" alt="Landlord Signature">`;
        document.getElementById('landlord-date').textContent = 'Date: ' + new Date().toLocaleDateString();
        // optionally store in hidden input for server submission
      });

      document.getElementById('tenant-save').addEventListener('click', function() {
        if (tenantSignaturePad.isEmpty()) {
          alert("Please provide a signature first.");
          return;
        }
        const dataURL = tenantSignaturePad.toDataURL();
        document.getElementById('tenant-preview').innerHTML = `<img src="${dataURL}" alt="Tenant Signature">`;
        document.getElementById('tenant-date').textContent = 'Date: ' + new Date().toLocaleDateString();
      });

      // Preserve drawing on resize: save dataURL, resize, then re-load
      window.addEventListener('resize', function() {
        // landlord
        const landlordData = landlordSignaturePad.isEmpty() ? null : landlordSignaturePad.toDataURL();
        setCanvasDisplaySize(landlordCanvas);
        landlordSignaturePad.clear();
        if (landlordData) landlordSignaturePad.fromDataURL(landlordData);

        // tenant
        const tenantData = tenantSignaturePad.isEmpty() ? null : tenantSignaturePad.toDataURL();
        setCanvasDisplaySize(tenantCanvas);
        tenantSignaturePad.clear();
        if (tenantData) tenantSignaturePad.fromDataURL(tenantData);
      });
    });

    // Download report as PDF via backend
    function downloadReport() {
      try {
        const url = window.location.pathname.replace('/report/', '/report/download/');
        window.location.href = url;
      } catch(e) {
        console.error('Download error:', e);
        alert('Error downloading report. Please try again.');
      }
      return false;
    }
    </script>
</body>
</html>