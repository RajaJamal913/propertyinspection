<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Report - {{ property.address }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
 
<style>
  :root {
    --primary: #1a4f72;
    --secondary: #6c757d;
    --light: #f8fafc;
    --dark: #343a40;
    --accent: #1e88e5;
    --success: #28a745;
    --warning: #ffc107;
    --border: #e2e8f0;
    --gallery-image-height: 180px;
    --thumbnail-size: 100px;
    --gallery-cols: 4;
    --image-aspect-ratio: 4/3;
}

/* Base (unchanged) – keep all your existing screen styles */
body {
    background: #f8fafc;
    color: #334155;
    font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    line-height: 1.6;
}
.report-container {
    max-width: 1200px;
    margin: 2rem auto;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    overflow: hidden;
}
/* ... all your other screen styles remain exactly as they were ... */

/* ========== PRINT STYLES – COMPACT & FULL‑WIDTH ========== */
@media print {
    :root {
        --gallery-image-height: 70mm !important;
        --thumbnail-size: 40mm !important;
        --image-aspect-ratio: 4/3 !important;
        --print-image-width: 130px;
    }

    * { 
        -webkit-print-color-adjust: exact !important; 
        print-color-adjust: exact !important; 
        color-adjust: exact !important; 
    }

    @page { 
        margin: 0 !important;
        size: A4 portrait !important;
    }

    html, body { 
        margin: 0 !important;        /* was 15mm top – remove top margin as well? keep or set 0 */
        padding: 0 !important;
        background: white !important;
        font-size: 10pt !important;  /* slightly smaller base font */
        line-height: 1.3 !important;
    }

    .report-container { 
        box-shadow: none !important; 
        margin: 0 !important;         /* zero all margins */
        border: none !important; 
        border-radius: 0 !important; 
        width: 100% !important; 
        max-width: 100% !important; 
        overflow: visible !important;
        page-break-after: avoid !important;
    }

    .no-print, .no-print * { display: none !important; visibility: hidden !important; }

    .report-header {
        background: var(--primary) !important; 
        color: white !important;
        padding: 0.5rem 0.75rem !important;   /* reduced padding */
        margin-bottom: 0.2rem !important;
        page-break-after: avoid !important;
    }
    .header-pattern { display: none !important; }

    /* ---------- IMAGE GALLERIES – 4 COLUMNS ---------- */
    .photo-gallery,
    .sub-entity-gallery {
        grid-template-columns: repeat(4, 1fr) !important;
        gap: 3px !important;           /* smaller gap */
        margin: 0 0 4px 0 !important;
    }
    .flex-gallery-2col,
    .flex-gallery-3col {
        gap: 2mm !important;
    }
    .flex-gallery-2col .photo-item,
    .flex-gallery-3col .photo-item {
        flex: 0 0 var(--print-image-width) !important;
        max-width: var(--print-image-width) !important;
    }
    .photo-item, 
    .sub-entity-photo {
        border: 0.25pt solid #ccc !important;
        border-radius: 0.5mm !important;
    }
    .photo-item img {
        object-fit: cover !important;
    }
    .figure-caption {
        font-size: 7pt !important;
        padding: 1mm !important;
    }

    /* ---------- DETAILS – STACKED BUT COMPACT ---------- */
    .details-grid {
        display: grid !important;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)) !important;
        gap: 2mm !important;
        margin-bottom: 0 !important;
    }
    .detail-item {
        display: block !important;
        width: 100% !important;
        padding: 0.1rem 0.2rem !important;
        margin-bottom: 0.1rem !important;
        background: transparent !important;
        border-left: 0.5pt solid var(--accent) !important;
        page-break-inside: avoid !important;
    }
    .detail-item-label {
        font-size: 7pt !important;
        font-weight: 700 !important;
        margin-bottom: 0 !important;
    }
    .detail-item-value {
        font-size: 8pt !important;
        font-weight: 500 !important;
        color: #000 !important;
        margin-bottom: 0 !important;
    }

    /* ---------- TIGHT SPACING EVERYWHERE ---------- */
    .section-card { 
        margin-bottom: 0.3rem !important;    /* was 0.6rem */
        page-break-inside: auto !important;  /* allow breaking inside to fill pages */
        border: 0.5pt solid #ddd !important;
    }
    .section-header { 
        padding: 0.2rem 0.5rem !important;
        font-size: 9pt !important;
        border-bottom: 0.5pt solid #ddd !important;
    }
    .section-body {
        padding: 0.3rem !important;          /* was 0.6rem */
    }

    .sub-section {
        margin-bottom: 0.3rem !important;
        page-break-inside: auto !important;
    }
    .sub-section-header {
        margin-bottom: 0.2rem !important;
        padding-bottom: 0.1rem !important;
        font-size: 9pt !important;
        border-bottom: 0.5pt solid #ccc !important;
    }

    .summary-grid { 
        grid-template-columns: repeat(3, 1fr) !important; 
        gap: 0.1rem !important; 
        margin: 0.2rem 0 !important; 
    }
    .summary-item { 
        padding: 0.2rem !important; 
        border: 0.5pt solid #ddd !important; 
        box-shadow: none !important; 
    }
    .summary-count { font-size: 1rem !important; }
    .summary-label { font-size: 0.6rem !important; }

    /* ---------- COMPACT "ABOUT THIS REPORT" ---------- */
    .intro-section {
        background: #f0f8ff !important;
        border-left: 2pt solid var(--accent) !important;
        padding: 0.3rem !important;
        margin-bottom: 0.3rem !important;
    }
    .intro-section .row {
        display: grid !important;
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 0.1rem !important;
    }
    .intro-title {
        font-size: 0.9rem !important;
        margin-bottom: 0.2rem !important;
        padding-bottom: 0.1rem !important;
    }
    .intro-card {
        border: 0.5pt solid #ddd !important;
        margin: 0 !important;
    }
    .intro-card-header {
        padding: 0.2rem 0.3rem !important;
        font-size: 0.7rem !important;
    }
    .intro-card-body {
        padding: 0.2rem !important;
        font-size: 0.65rem !important;
        line-height: 1.2 !important;
    }
    .intro-card-body ul {
        padding-left: 0.6rem !important;
    }

    .disclaimer-box {
        padding: 0.3rem !important;
        font-size: 0.65rem !important;
        margin-top: 0.3rem !important;
        border: 0.5pt solid #ffecb3 !important;
    }
    .disclaimer-header {
        font-size: 0.7rem !important;
        margin-bottom: 0.2rem !important;
    }

    /* ---------- COMPONENTS & TABLES ---------- */
    .component-container {
        margin-bottom: 0.3rem !important;    /* reduced */
        page-break-inside: auto !important;  /* allow split */
        border: 0.5pt solid #ddd !important;
    }
    .component-details,
    .component-photos {
        padding: 0.3rem !important;          /* was 0.4rem */
    }
    .component-title {
        font-size: 0.8rem !important;
        margin-bottom: 0.2rem !important;
    }

    .data-table { 
        font-size: 8pt !important;
    }
    .data-table th,
    .data-table td { 
        padding: 0.2rem !important; 
        border: 0.25pt solid #ddd !important;
    }

    .room-card,
    .utility-card {
        margin-bottom: 0.3rem !important;
        page-break-inside: auto !important;
        border: 0.5pt solid #ddd !important;
    }

    .utility-details { 
        grid-template-columns: repeat(2, 1fr) !important; 
        gap: 0.2rem !important;
    }

    /* ---------- SIGNATURE SECTION ---------- */
    .signature-section {
        border-top: 0.5pt dashed #aaa !important;
        margin-top: 0.3rem !important;
        padding-top: 0.3rem !important;
        page-break-inside: avoid !important;  /* keep signature together */
    }
    .signature-header {
        font-size: 0.9rem !important;
        margin-bottom: 0.3rem !important;
    }
    .signature-container {
        gap: 0.5rem !important;
    }
    .signature-box {
        min-width: 40% !important;
    }
    .signature-pad {
        height: 20mm !important;              /* smaller */
        border: 0.5pt solid #000 !important;
    }
    .signature-name-line,
    .signature-date-line {
        font-size: 0.7rem !important;
        margin-top: 0.2rem !important;
    }
    .signature-line {
        border-bottom: 0.5pt solid #000 !important;
        height: 0.8rem !important;
    }
    .signature-date {
        border-bottom: 0.5pt solid #000 !important;
        min-height: 0.8rem !important;
    }
    .signature-actions,
    .signature-preview:empty,
    .alert.alert-info {
        display: none !important;
    }

    /* ---------- REMOVE BOTTOM MARGINS FROM LAST ELEMENTS ---------- */
    .section-body:last-child,
    .component-container:last-child,
    .room-card:last-child,
    .sub-section:last-child,
    .intro-card:last-child {
        margin-bottom: 0 !important;
    }

    /* ---------- PAGE BREAK CONTROL – let content flow ---------- */
    h2, h3, h4, .section-header, .sub-section-header {
        page-break-after: avoid !important;
        margin-bottom: 0.1rem !important;
    }

    /* Allow most containers to break inside to fill pages */
    .component-container,
    .room-card,
    .utility-card,
    .sub-section,
    .section-card {
        page-break-inside: auto !important;
        break-inside: auto !important;
    }

    /* But keep small cards together if possible */
    .intro-card,
    .summary-item,
    .detail-item {
        page-break-inside: avoid !important;
    }

    .print-btn { display: none !important; }
    a[href]::after { content: none !important; }
    img { max-width: 100% !important; page-break-inside: avoid !important; }

    /* Full width property views */
    .property-views-row {
        display: flex !important;
        flex-wrap: nowrap !important;
        margin: 0 !important;
    }
    .property-views-row > [class*="col-"] {
        flex: 0 0 50% !important;
        max-width: 50% !important;
        padding: 0 2px !important;
    }

    /* Footer minimal */
    .footer {
        padding: 0.2rem 0 !important;
        margin-top: 0.2rem !important;
        border-top: 0.5pt solid #ddd !important;
        background: transparent !important;
    }
}
</style>
</head>
<body>
    <div class="report-container">
        <!-- Report Header -->
        <div class="report-header">
            <div class="header-pattern"></div>
            <div class="header-content">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h1 class="h2 mb-3">LetCheck Ltd Inventory & Schedule of condition </h1>
                        <h2 class="h4 mb-2">{{ property.address }}</h2>
                        <p class="mb-0 opacity-75">{{ now|date:"F j, Y" }}</p>
                    </div>
                    
                    <div class="text-end no-print">
                        <button class="print-btn" id="downloadBtn" type="button" onclick="window.print()">
                            <i class="bi bi-download"></i> Download Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- About This Report Section -->
        <div class="p-4 p-lg-5 intro-section">
            <h3 class="intro-title">
                <i class="bi bi-info-circle me-2"></i>About This Inventory Report
            </h3>
            
            <div class="row g-3">
                <!-- Card 1: What is this report? -->
                <div class="col-md-6 col-lg-4">
                    <div class="intro-card">
                        <div class="intro-card-header">
                            <div class="intro-icon">
                                <i class="bi bi-file-earmark-text"></i>
                            </div>
                            What is this Report?
                        </div>
                        <div class="intro-card-body">
                            <p>The LetCheck Ltd Property Inventory Report provides an accurate, impartial record of the property's condition.</p>
                            <p class="mb-0">It documents both the overall state of the premises and the condition of individual items where applicable.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Card 2: Why is it valuable? -->
                <div class="col-md-6 col-lg-4">
                    <div class="intro-card">
                        <div class="intro-card-header">
                            <div class="intro-icon">
                                <i class="bi bi-shield-check"></i>
                            </div>
                            Why is it Valuable?
                        </div>
                        <div class="intro-card-body">
                            <p>This report is essential for avoiding deposit disputes at the end of a tenancy.</p>
                            <p class="mb-0">Official guidance recommends independent inventory services to record the property's state at both start and end of the rental period.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Card 3: Who can use it? -->
                <div class="col-md-6 col-lg-4">
                    <div class="intro-card">
                        <div class="intro-card-header">
                            <div class="intro-icon">
                                <i class="bi bi-people"></i>
                            </div>
                            Who Can Use This?
                        </div>
                        <div class="intro-card-body">
                            <p>As an impartial report from an independent provider, it can be relied upon by:</p>
                            <ul class="mb-0">
                                <li>Landlords</li>
                                <li>Tenants</li>
                                <li>Letting Agents</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Card 4: What's included? -->
                <div class="col-md-6 col-lg-4">
                    <div class="intro-card">
                        <div class="intro-card-header">
                            <div class="intro-icon">
                                <i class="bi bi-check-circle"></i>
                            </div>
                            What's Included?
                        </div>
                        <div class="intro-card-body">
                            <ul>
                                <li>Room-by-room breakdown of condition</li>
                                <li>Documented defects with photos</li>
                                <li>Items not mentioned are assumed in good condition</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Card 5: What's not covered? -->
                <div class="col-md-6 col-lg-4">
                    <div class="intro-card">
                        <div class="intro-card-header">
                            <div class="intro-icon">
                                <i class="bi bi-x-circle"></i>
                            </div>
                            What's Not Covered?
                        </div>
                        <div class="intro-card-body">
                            <ul>
                                <li>Safety compliance assessments</li>
                                <li>Structural soundness checks</li>
                                <li>Valuation or building survey</li>
                                <li>Personal belongings or valuables</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Card 6: Inspection scope -->
                <div class="col-md-6 col-lg-4">
                    <div class="intro-card">
                        <div class="intro-card-header">
                            <div class="intro-icon">
                                <i class="bi bi-search"></i>
                            </div>
                            Inspection Scope
                        </div>
                        <div class="intro-card-body">
                            <p><strong>Includes:</strong> Visible areas of main building, accessible outbuildings and gardens</p>
                            <p class="mb-0"><strong>Excludes:</strong> Common areas in flats, roof spaces, locked areas, and overfilled storage spaces</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Disclaimer Box -->
            <div class="disclaimer-box">
                <div class="disclaimer-header">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    Important Disclaimer
                </div>
                <p class="mb-0">Every effort has been made to ensure the accuracy of this inventory; however, LetCheck Ltd cannot guarantee absolute accuracy.
It is the responsibility of both the landlord and tenant to review this document carefully and confirm its correctness by signing below.

This report records the furniture, furnishings, and landlord-owned items present in the property on the date of inspection. It does not provide a guarantee of adequacy, safety, or compliance — it simply confirms the existence and observed condition of these items at the time of the inventory.

By signing this document, the undersigned agree that, subject to any notes or amendments, it represents a fair and accurate record of the property's condition and contents.

The tenant and/or landlord has seven (7) days from receipt of this report to notify the landlord, agent or LetCheck Ltd of any discrepancies.</p>
            </div>
        </div>
        
        <!-- Report Content -->
        <div class="p-4 p-lg-5">
            <!-- Cleaning Standard -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-brush"></i>
                    </div>
                    Cleaning Standard
                </div>
                <div class="section-body">
                    <p style="margin: 0; font-size: 0.95rem; line-height: 1.6;">This property has been cleaned to a good standard unless indicated else where on the inventory report.</p>
                </div>
            </div>

            <!-- Property Details -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-info-circle"></i>
                    </div>
                    Property Details
                </div>
                <div class="section-body">
                    <table class="table table-borderless mb-0">
                        <tr>
                            <td class="fw-medium text-muted" width="30%">Address</td>
                            <td>{{ property.address }}</td>
                        </tr>
                        <tr>
                            <td class="fw-medium text-muted">Postcode</td>
                            <td>{{ property.postcode }}</td>
                        </tr>
                        <tr>
                            <td class="fw-medium text-muted">Property Type</td>
                            <td>{{ property.propertyType }}</td>
                        </tr>
                        <tr>
                            <td class="fw-medium text-muted">Detachment</td>
                            <td>{{ property.detachment }}</td>
                        </tr>
                        <tr>
                            <td class="fw-medium text-muted">Inspected By</td>
                            <td>{{ inspected_by }}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- ========== COMBINED PROPERTY VIEWS SECTION WITH PRINT FIX ========== -->
            {% if front_photos and front_photos|length > 0 or other_views and other_views|length > 0 %}
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-images"></i>
                    </div>
                    Property Views
                </div>
                <div class="section-body">
                    <!-- Added class "property-views-row" for print control -->
                    <div class="row g-4 property-views-row">
                        <!-- Front View Column -->
                        {% if front_photos and front_photos|length > 0 %}
                        <div class="col-md-6">
                            <h5 class="sub-section-header">
                                <i class="bi bi-camera me-2"></i>Front View
                            </h5>
                            <div class="flex-gallery-2col">
                                {% for url in front_photos %}
                                    {% if url %}
                                    <figure class="photo-item">
                                        <img src="{{ url }}" 
                                             alt="Front View {{ forloop.counter }}" 
                                             loading="lazy"
                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                        <div class="image-meta">
                                            <span>{{ now|date:"Y-m-d" }}</span>
                                            <span>Front</span>
                                        </div>
                                    </figure>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Other Views Column -->
                        {% if other_views and other_views|length > 0 %}
                        <div class="col-md-6">
                            <h5 class="sub-section-header">
                                <i class="bi bi-camera2 me-2"></i>Other View
                            </h5>
                            <div class="flex-gallery-2col">
                                {% for url in other_views %}
                                    {% if url %}
                                    <figure class="photo-item">
                                        <img src="{{ url }}" 
                                             alt="Property View {{ forloop.counter }}" 
                                             loading="lazy"
                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                        <div class="image-meta">
                                            <span>{{ now|date:"Y-m-d" }}</span>
                                            <span>External</span>
                                        </div>
                                    </figure>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Summary Section - Always show -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-clipboard-data"></i>
                    </div>
                    Property Summary
                </div>
                <div class="section-body">
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-icon text-primary">
                                <i class="bi bi-people"></i>
                            </div>
                            <div class="summary-count">{{ tenant_count }}</div>
                            <div class="summary-label">Tenants</div>
                        </div>
                        
                        <div class="summary-item">
                            <div class="summary-icon text-info">
                                <i class="bi bi-lightning-charge"></i>
                            </div>
                            <div class="summary-count">{% if utility %}1{% else %}0{% endif %}</div>
                            <div class="summary-label">Utilities</div>
                        </div>
                        
                        <div class="summary-item">
                            <div class="summary-icon text-warning">
                                <i class="bi bi-alarm"></i>
                            </div>
                            <div class="summary-count">{{ detector_count }}</div>
                            <div class="summary-label">Detectors</div>
                        </div>
                        
                        <div class="summary-item">
                            <div class="summary-icon text-danger">
                                <i class="bi bi-key"></i>
                            </div>
                            <div class="summary-count">{{ key_count }}</div>
                            <div class="summary-label">Keys</div>
                        </div>
                        
                        <div class="summary-item">
                            <div class="summary-icon text-secondary">
                                <i class="bi bi-files"></i>
                            </div>
                            <div class="summary-count">{{ document_count }}</div>
                            <div class="summary-label">Documents</div>
                        </div>
                        
                        <div class="summary-item">
                            <div class="summary-icon text-success">
                                <i class="bi bi-door-open"></i>
                            </div>
                            <div class="summary-count">{{ total_rooms }}</div>
                            <div class="summary-label">Rooms</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ========== POST‑SUMMARY CONTENT WRAPPER ========== -->
            <div class="post-summary-sections">
            
            <!-- Tenants - Only show if tenants exist -->
            {% if property.tenantDetails and tenant_count > 0 %}
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-people"></i>
                    </div>
                    Tenants
                    <span class="badge-count">{{ tenant_count }}</span>
                </div>
                <div class="section-body">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Contact</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for t in property.tenantDetails %}
                            <tr>
                                <td>{{ t.tenantName }}</td>
                                <td>
                                    <div>{{ t.mobilePhone }}</div>
                                    <div class="small text-primary">
                                        <a href="mailto:{{ t.tenantEmail }}">{{ t.tenantEmail }}</a>
                                    </div>
                                </td>
                                <td>{{ t.notes|default:"—" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
            
            <!-- Utilities - Only show if utility data exists -->
            {% if utility and meters_count > 0 %}
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-lightning-charge"></i>
                    </div>
                    Utilities ({{ meters_count }})
                </div>
                <div class="section-body">
                    <!-- Gas Meter -->
                    <div class="sub-section mb-4">
                        <div class="sub-section-header">
                            <i class="bi bi-lightning-charge me-2"></i>
                            Gas Meter
                        </div>
                        <div class="component-container">
                            <div class="component-details">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-item-label">Serial Number</div>
                                        <div class="detail-item-value">{{ utility.gasMeterSerialNumber|default:"—" }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-item-label">Reading</div>
                                        <div class="detail-item-value">{{ utility.gasMeterReading|default:"—" }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="component-photos">
                                <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                {% if utility.gasMeterPhoto %}
                                    <div class="photo-gallery">
                                        {% for p in utility.gasMeterPhoto %}
                                        <figure class="photo-item">
                                            <img src="{{ p }}" 
                                                 alt="Gas meter photo" 
                                                 loading="lazy"
                                                 onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                          
                                        </figure>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Electricity Meter -->
                    <div class="sub-section mb-4">
                        <div class="sub-section-header">
                            <i class="bi bi-lightning-charge me-2"></i>
                            Electricity Meter
                        </div>
                        <div class="component-container">
                            <div class="component-details">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-item-label">Serial Number</div>
                                        <div class="detail-item-value">{{ utility.electricityMeterSerialNumber|default:"—" }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-item-label">Reading</div>
                                        <div class="detail-item-value">{{ utility.electricityMeterReading|default:"—" }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="component-photos">
                                <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                {% if utility.electricityMeterPhoto %}
                                    <div class="photo-gallery">
                                        {% for p in utility.electricityMeterPhoto %}
                                        <figure class="photo-item">
                                            <img src="{{ p }}" 
                                                 alt="Electricity meter photo" 
                                                 loading="lazy"
                                                 onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                           
                                        </figure>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Water Meter -->
                    {% if utility.waterMeterReading or utility.waterMeterSerialNumber or utility.waterMeterPhoto %}
                    <div class="sub-section mb-4">
                        <div class="sub-section-header">
                            <i class="bi bi-water me-2"></i>
                            Water Meter
                        </div>
                        <div class="component-container">
                            <div class="component-details">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-item-label">Serial Number</div>
                                        <div class="detail-item-value">{{ utility.waterMeterSerialNumber|default:"—" }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-item-label">Reading</div>
                                        <div class="detail-item-value">{{ utility.waterMeterReading|default:"—" }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="component-photos">
                                <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                {% if utility.waterMeterPhoto %}
                                    <div class="photo-gallery">
                                        {% for p in utility.waterMeterPhoto %}
                                        <figure class="photo-item">
                                            <img src="{{ p }}" 
                                                 alt="Water meter photo" 
                                                 loading="lazy"
                                                 onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                           
                                        </figure>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Heat Meter -->
                    {% if utility.heatMeterReading or utility.heatMeterSerialNumber or utility.heatMeterPhoto %}
                    <div class="sub-section mb-4">
                        <div class="sub-section-header">
                            <i class="bi bi-fire me-2"></i>
                            Heat Meter
                        </div>
                        <div class="component-container">
                            <div class="component-details">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-item-label">Serial Number</div>
                                        <div class="detail-item-value">{{ utility.heatMeterSerialNumber|default:"—" }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-item-label">Reading</div>
                                        <div class="detail-item-value">{{ utility.heatMeterReading|default:"—" }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="component-photos">
                                <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                {% if utility.heatMeterPhoto %}
                                    <div class="photo-gallery">
                                        {% for p in utility.heatMeterPhoto %}
                                        <figure class="photo-item">
                                            <img src="{{ p }}" 
                                                 alt="Heat meter photo" 
                                                 loading="lazy"
                                                 onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                            
                                        </figure>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Other Meter -->
                    {% if utility.otherMeterType or utility.otherMeterReading or utility.otherMeterSerialNumber or utility.otherMeterPhoto %}
                    <div class="sub-section mb-4">
                        <div class="sub-section-header">
                            <i class="bi bi-lightning-charge me-2"></i>
                            {{ utility.otherMeterType }} Meter
                        </div>
                        <div class="component-container">
                            <div class="component-details">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-item-label">Serial Number</div>
                                        <div class="detail-item-value">{{ utility.otherMeterSerialNumber|default:"—" }}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-item-label">Reading</div>
                                        <div class="detail-item-value">{{ utility.otherMeterReading|default:"—" }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="component-photos">
                                <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                {% if utility.otherMeterPhoto %}
                                    <div class="photo-gallery">
                                        {% for p in utility.otherMeterPhoto %}
                                        <figure class="photo-item">
                                            <img src="{{ p }}" 
                                                 alt="Other meter photo" 
                                                 loading="lazy"
                                                 onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                            
                                        </figure>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Stopcock -->
                    <div class="sub-section mb-4">
                        <div class="sub-section-header">
                            <i class="bi bi-water me-2"></i>
                            Stopcock
                        </div>
                        <div class="component-container">
                            <div class="component-details">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-item-label">Location</div>
                                        <div class="detail-item-value">{{ utility.stopcokLocation|default:"—" }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="component-photos">
                                <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                {% if utility.stopcokPhoto %}
                                    <div class="photo-gallery">
                                        {% for p in utility.stopcokPhoto %}
                                        <figure class="photo-item">
                                            <img src="{{ p }}" 
                                                 alt="Stopcock photo" 
                                                 loading="lazy"
                                                 onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                           
                                        </figure>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Fusebox -->
                    <div class="sub-section mb-4">
                        <div class="sub-section-header">
                            <i class="bi bi-lightning me-2"></i>
                            Fusebox
                        </div>
                        <div class="component-container">
                            <div class="component-details">
                                <div class="details-grid">
                                    <div class="detail-item">
                                        <div class="detail-item-label">Location</div>
                                        <div class="detail-item-value">{{ utility.fuseboxLocation|default:"—" }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="component-photos">
                                <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                {% if utility.fuseboxPhoto %}
                                    <div class="photo-gallery">
                                        {% for p in utility.fuseboxPhoto %}
                                        <figure class="photo-item">
                                            <img src="{{ p }}" 
                                                 alt="Fusebox photo" 
                                                 loading="lazy"
                                                 onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                           
                                        </figure>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Detectors - Only show if detectors exist -->
            {% if property.detectors and detector_count > 0 %}
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-alarm"></i>
                    </div>
                    Detectors
                    <span class="badge-count">{{ detector_count }}</span>
                </div>
                <div class="section-body">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Location</th>
                                <th>Working</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for detector in property.detectors %}
                            <tr>
                                <td>
                                    {% if detector.detectorType %}
                                        {% if detector.detectorType == 'Smoke' %}Smoke Detector
                                        {% elif detector.detectorType == 'CO' %}CO Detector
                                        {% elif detector.detectorType == 'Heat' %}Heat Detector
                                        {% else %}{{ detector.detectorType }}{% endif %}
                                    {% elif detector.type %}
                                        {% if detector.type == 'smoke' or detector.type == 'Smoke' %}Smoke Detector
                                        {% elif detector.type == 'co' or detector.type == 'CO' %}CO Detector
                                        {% elif detector.type == 'heat' or detector.type == 'Heat' %}Heat Detector
                                        {% else %}{{ detector.type|title }} Detector{% endif %}
                                    {% else %}
                                        Unknown
                                    {% endif %}
                                </td>
                                <td>{{ detector.location|default:"—" }}</td>
                                <td>
                                    {% if detector.working == True or detector.working == 'true' or detector.working == 'Yes' or detector.working == 'yes' %}
                                        <span class="text-success">Yes</span>
                                    {% elif detector.working == False or detector.working == 'false' or detector.working == 'No' or detector.working == 'no' %}
                                        <span class="text-danger">No</span>
                                    {% elif detector.working == 'Unknown' or detector.working == 'unknown' %}
                                        Unknown
                                    {% else %}
                                        {{ detector.working|default:"—" }}
                                    {% endif %}
                                </td>
                                <td>{{ detector.notes|default:"—" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    
                    <!-- Detector Compliance (if exists) -->
                    {% if property.detectorCompliance %}
                    <div class="sub-section" style="margin-top: 2rem;">
                        <div class="sub-section-header">
                            <i class="bi bi-check2-circle me-2"></i>
                            Detector Compliance Status
                        </div>
                        <table class="table table-borderless">
                            <tr>
                                <td class="kv">Smoke Alarm Compliance</td>
                                <td class="val">
                                    {% if property.detectorCompliance.smokeAlarmCompliance == True or property.detectorCompliance.smokeAlarmCompliance == 'true' or property.detectorCompliance.smokeAlarmCompliance == 'Yes' %}
                                        <span class="text-success">Yes</span>
                                    {% elif property.detectorCompliance.smokeAlarmCompliance == False or property.detectorCompliance.smokeAlarmCompliance == 'false' or property.detectorCompliance.smokeAlarmCompliance == 'No' %}
                                        <span class="text-danger">No</span>
                                    {% else %}
                                        {{ property.detectorCompliance.smokeAlarmCompliance|default:"Not recorded" }}
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td class="kv">Carbon Monoxide Compliance</td>
                                <td class="val">
                                    {% if property.detectorCompliance.carbonMonoxideCompliance == True or property.detectorCompliance.carbonMonoxideCompliance == 'true' or property.detectorCompliance.carbonMonoxideCompliance == 'Yes' %}
                                        <span class="text-success">Yes</span>
                                    {% elif property.detectorCompliance.carbonMonoxideCompliance == False or property.detectorCompliance.carbonMonoxideCompliance == 'false' or property.detectorCompliance.carbonMonoxideCompliance == 'No' %}
                                        <span class="text-danger">No</span>
                                    {% else %}
                                        {{ property.detectorCompliance.carbonMonoxideCompliance|default:"Not recorded" }}
                                    {% endif %}
                                </td>
                            </tr>
                        </table>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
            <!-- Keys - Only show if keys exist -->
            {% if property.keys and key_count > 0 %}
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-key"></i>
                    </div>
                    Keys
                    <span class="badge-count">{{ key_count }}</span>
                </div>
                <div class="section-body">
                    {% for k in property.keys %}
                    <div class="component-container">
                        <div class="component-details">
                            <div class="details-grid">
                                <div class="detail-item">
                                    <div class="detail-item-label">Description</div>
                                    <div class="detail-item-value">{{ k.description }}</div>
                                </div>
                                {% if k.notes %}
                                <div class="detail-item">
                                    <div class="detail-item-label">Notes</div>
                                    <div class="detail-item-value">{{ k.notes }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="component-photos">
                            <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                            {% if k.photo %}
                                <div class="photo-gallery">
                                    {% for photo_url in k.photo %}
                                    <figure class="photo-item">
                                        <img src="{{ photo_url }}" 
                                             alt="{{ k.description }}" 
                                             loading="lazy"
                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                      
                                    </figure>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Documents - Only show if documents exist -->
            {% if property.documents and document_count > 0 %}
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-files"></i>
                    </div>
                    Documents
                    <span class="badge-count">{{ document_count }}</span>
                </div>
                <div class="section-body">
                    {% for doc in property.documents %}
                    <div class="component-container">
                        <div class="component-details">
                            <div class="details-grid">
                                <div class="detail-item">
                                    <div class="detail-item-label">Description</div>
                                    <div class="detail-item-value">{{ doc.description }}</div>
                                </div>
                                {% if doc.notes %}
                                <div class="detail-item">
                                    <div class="detail-item-label">Notes</div>
                                    <div class="detail-item-value">{{ doc.notes }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="component-photos">
                            <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                            {% if doc.photo %}
                                <div class="photo-gallery">
                                    {% for photo_url in doc.photo %}
                                    <figure class="photo-item">
                                        <img src="{{ photo_url }}" 
                                             alt="{{ doc.description }}" 
                                             loading="lazy"
                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                       
                                    </figure>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- ROOMS SECTION - Only show if rooms exist -->
            {% if property.rooms and total_rooms > 0 %}
            <h2 style="margin-top: 2rem; margin-bottom: 1rem; padding: 1rem; background: linear-gradient(135deg, #1a4f72 0%, #0d3a5d 100%); color: white; border-radius: 8px; font-size: 1.5rem; font-weight: 600;"><i class="bi bi-house-door me-2"></i>Rooms</h2>
            
                {% for r in property.rooms %}
                {% cycle '#e6f2ff' '#f3e5f5' '#e8f5e9' '#fff3e0' '#fce4ec' '#e0f2f1' '#f1f8e9' '#ede7f6' as bg_color silent %}
                {% cycle '#1a4f72' '#6a1b9a' '#2e7d32' '#e65100' '#c2185b' '#00695c' '#558b2f' '#512da8' as text_color silent %}
                {% cycle '#1e88e5' '#9c27b0' '#4caf50' '#ff9800' '#e91e63' '#009688' '#8bc34a' '#673ab7' as border_color silent %}
                <h3 style="margin-top: 1.5rem; margin-bottom: 0.8rem; padding: 0.8rem 1rem; background: {{ bg_color }}; color: {{ text_color }}; border-left: 4px solid {{ border_color }}; font-size: 1.2rem; font-weight: 600;">
                    <i class="bi bi-house-door me-2"></i>{{ r.roomType }}
                    {% if r.overviewComments %}<span class="badge bg-success ms-2">{{ r.overviewComments }}</span>{% endif %}
                </h3>
                                <!-- Room Notes -->
                                {% if r.notes|length > 0 %}
                                <div class="alert alert-info mb-4">
                                    <i class="bi bi-info-circle me-2"></i>
                                    <strong>Room Notes:</strong> {{ r.notes }}
                                </div>
                                {% endif %}
                                {% if r.photo %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-images me-2"></i>
                                        Room Overview
                                    </div>
                                    <div class="photo-gallery">
                                        {% for photo_url in r.photo %}
                                        <figure class="photo-item">
                                            <img src="{{ photo_url }}" 
                                                 alt="Room overview for {{ r.roomType }}" 
                                                 loading="lazy"
                                                 onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                            
                                            <div class="image-meta">
                                                <span>{{ now|date:"Y-m-d" }}</span>
                                                <span>{{ r.roomType }}</span>
                                            </div>
                                        </figure>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Doors Section -->
                                {% if r.doors %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-door-closed me-2"></i>
                                        Doors
                                        <span class="badge-count">{{ r.doors|length }}</span>
                                    </div>
                                    {% for d in r.doors %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Finish</div>
                                                    <div class="detail-item-value">{{ d.doorFinish }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Color</div>
                                                    <div class="detail-item-value">{{ d.doorColour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Frame Type</div>
                                                    <div class="detail-item-value">{{ d.frameType }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Frame Color</div>
                                                    <div class="detail-item-value">{{ d.frameColour }}</div>
                                                </div>
                                                {% if d.features %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Features</div>
                                                    <div class="detail-item-value">{{ d.features }}</div>
                                                </div>
                                                {% endif %}
                                                {% if d.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ d.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title">{{ d.doorType }} - {{ d.condition }}</div>
                                            {% if d.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in d.photo %}
                                                    <figure class="photo-item">
                                                        <img src="{{ photo_url }}" 
                                                             alt="{{ d.doorType }} in {{ r.roomType }}" 
                                                             loading="lazy"
                                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                                        
                                                    </figure>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Windows Section -->
                                {% if r.windows %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-window me-2"></i>
                                        Windows
                                        <span class="badge-count">{{ r.windows|length }}</span>
                                    </div>
                                    {% for w in r.windows %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Glass Type</div>
                                                    <div class="detail-item-value">{{ w.glassType }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Frame Type</div>
                                                    <div class="detail-item-value">{{ w.frameType }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Sill Type</div>
                                                    <div class="detail-item-value">{{ w.sillType }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Frame Color</div>
                                                    <div class="detail-item-value">{{ w.frameColour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Sill Color</div>
                                                    <div class="detail-item-value">{{ w.sillColour }}</div>
                                                </div>
                                                {% if w.features %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Features</div>
                                                    <div class="detail-item-value">{{ w.features }}</div>
                                                </div>
                                                {% endif %}
                                                {% if w.openers %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Openers</div>
                                                    <div class="detail-item-value">{{ w.openers }}</div>
                                                </div>
                                                {% endif %}
                                                {% if w.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ w.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title">{{ w.windowType }} - {{ w.condition }}</div>
                                            {% if w.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in w.photo %}
                                                    <figure class="photo-item">
                                                        <img src="{{ photo_url }}" 
                                                             alt="{{ w.windowType }} in {{ r.roomType }}" 
                                                             loading="lazy"
                                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                                      
                                                    </figure>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Ceilings Section -->
                                {% if r.ceilings %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-square me-2"></i>
                                        Ceilings
                                        <span class="badge-count">{{ r.ceilings|length }}</span>
                                    </div>
                                    {% for c in r.ceilings %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Color</div>
                                                    <div class="detail-item-value">{{ c.colour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Fittings</div>
                                                    <div class="detail-item-value">{{ c.ceilingFittings }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Recessed Spotlights</div>
                                                    <div class="detail-item-value">{{ c.recessedSpotlights }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Bulbs Not Working</div>
                                                    <div class="detail-item-value">{{ c.bulbsNotWorking }}</div>
                                                </div>
                                                {% if c.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ c.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title">{{ c.ceilingFinish }} - {{ c.condition }}</div>
                                            {% if c.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in c.photo %}
                                                    <figure class="photo-item">
                                                        <img src="{{ photo_url }}" 
                                                             alt="Ceiling in {{ r.roomType }}" 
                                                             loading="lazy"
                                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                                        
                                                    </figure>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Floors Section -->
                                {% if r.floors %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-border-width me-2"></i>
                                        Floors
                                        <span class="badge-count">{{ r.floors|length }}</span>
                                    </div>
                                    {% for f in r.floors %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Color</div>
                                                    <div class="detail-item-value">{{ f.colour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Additions</div>
                                                    <div class="detail-item-value">{{ f.additions|default:"—" }}</div>
                                                </div>
                                                {% if f.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ f.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title">{{ f.floorFinish }} - {{ f.condition }}</div>
                                            {% if f.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in f.photo %}
                                                    <figure class="photo-item">
                                                        <img src="{{ photo_url }}" 
                                                             alt="Floor in {{ r.roomType }}" 
                                                             loading="lazy"
                                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                                        
                                                    </figure>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Walls Section -->
                                {% if r.walls %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-border-left me-2"></i>
                                        Walls
                                        <span class="badge-count">{{ r.walls|length }}</span>
                                    </div>
                                    {% for w in r.walls %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Color</div>
                                                    <div class="detail-item-value">{{ w.colour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Skirting Type</div>
                                                    <div class="detail-item-value">{{ w.skirtingType }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Skirting Color</div>
                                                    <div class="detail-item-value">{{ w.skirtingColour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Features</div>
                                                    <div class="detail-item-value">{{ w.features|default:"—" }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Signs of Leakages</div>
                                                    <div class="detail-item-value">{{ w.signOfLeakages|yesno:"Yes,No" }}</div>
                                                </div>
                                                {% if w.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ w.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title">{{ w.description }} - {{ w.condition }}</div>
                                            {% if w.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in w.photo %}
                                                    <figure class="photo-item">
                                                        <img src="{{ photo_url }}" 
                                                             alt="Wall in {{ r.roomType }}" 
                                                             loading="lazy"
                                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                           
                                                    </figure>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Fixtures & Fittings Section -->
                                {% if r.fixturesFittings %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-lightning me-2"></i>
                                        Fixtures & Fittings
                                        <span class="badge-count">{{ r.fixturesFittings|length }}</span>
                                    </div>
                                    {% for f in r.fixturesFittings %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Light Switches</div>
                                                    <div class="detail-item-value">{{ f.lightSwitches }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Plug Sockets</div>
                                                    <div class="detail-item-value">{{ f.plugSockets }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Radiators</div>
                                                    <div class="detail-item-value">{{ f.radiators }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Light Fittings</div>
                                                    <div class="detail-item-value">{{ f.lightFittings }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Toilets</div>
                                                    <div class="detail-item-value">{{ f.toilets }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Basins</div>
                                                    <div class="detail-item-value">{{ f.basins }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Light Tested</div>
                                                    <div class="detail-item-value">{{ f.lightTested|yesno:"Yes,No" }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Sockets Tested</div>
                                                    <div class="detail-item-value">{{ f.plugSocketsTested|yesno:"Yes,No" }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Switches Safe</div>
                                                    <div class="detail-item-value">{{ f.electricSwitchesVisuallySafe|yesno:"Yes,No" }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Sockets Safe</div>
                                                    <div class="detail-item-value">{{ f.plugSocketsVisuallySafe|yesno:"Yes,No" }}</div>
                                                </div>
                                                {% if f.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ f.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title">{{ f.fixture }}</div>
                                            {% if f.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in f.photo %}
                                                    <figure class="photo-item">
                                                        <img src="{{ photo_url }}" 
                                                             alt="{{ f.fixture }} in {{ r.roomType }}" 
                                                             loading="lazy"
                                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                                        
                                                    </figure>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Furnishings Section -->
                                {% if r.furnishings %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-sofa me-2"></i>
                                        Furnishings
                                        <span class="badge-count">{{ r.furnishings|length }}</span>
                                    </div>
                                    {% for furn in r.furnishings %}
                                    <div class="component-container">
                                        {% if furn.notes %}
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ furn.notes }}</div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                        <div class="component-photos">
                                            <div class="component-title">{{ furn.furnishings }}</div>
                                            {% if furn.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in furn.photo %}
                                                    <figure class="photo-item">
                                                        <img src="{{ photo_url }}" 
                                                             alt="{{ furn.furnishings }} in {{ r.roomType }}" 
                                                             loading="lazy"
                                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                                        
                                                    </figure>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Cupboards Section -->
                                {% if r.cupboards %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-archive me-2"></i>
                                        Cupboards
                                        <span class="badge-count">{{ r.cupboards|length }}</span>
                                    </div>
                                    {% for cup in r.cupboards %}
                                    <div class="component-container">
                                        {% if cup.notes %}
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ cup.notes }}</div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                        <div class="component-photos">
                                            <div class="component-title">{{ cup.cupboardContent }}</div>
                                            {% if cup.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in cup.photo %}
                                                    <figure class="photo-item">
                                                        <img src="{{ photo_url }}" 
                                                             alt="{{ cup.cupboardContent }} in {{ r.roomType }}" 
                                                             loading="lazy"
                                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                                        
                                                    </figure>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0">No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <!-- Kitchen Appliances Section -->
                                {% if r.kitchenAppliances %}
                                <div class="sub-section mb-4">
                                    <div class="sub-section-header">
                                        <i class="bi bi-refrigerator me-2"></i>
                                        Kitchen Appliances
                                        <span class="badge-count">{{ r.kitchenAppliances|length }}</span>
                                    </div>
                                    {% for a in r.kitchenAppliances %}
                                    <div class="component-container">
                                        <div class="component-details">
                                            <div class="details-grid">
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Type</div>
                                                    <div class="detail-item-value">{{ a.kitchenAppliances }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Condition</div>
                                                    <div class="detail-item-value">{{ a.condition }}</div>
                                                </div>
                                                {% if a.brand %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Brand</div>
                                                    <div class="detail-item-value">{{ a.brand }}</div>
                                                </div>
                                                {% endif %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Color</div>
                                                    <div class="detail-item-value">{{ a.colour }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Quantity</div>
                                                    <div class="detail-item-value">{{ a.quantity }}</div>
                                                </div>
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Tested</div>
                                                    <div class="detail-item-value">{{ a.tested|yesno:"Yes,No" }}</div>
                                                </div>
                                                {% if a.notes %}
                                                <div class="detail-item">
                                                    <div class="detail-item-label">Notes</div>
                                                    <div class="detail-item-value">{{ a.notes }}</div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="component-photos">
                                            <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                                            {% if a.photo %}
                                                <div class="photo-gallery">
                                                    {% for photo_url in a.photo %}
                                                    <figure class="photo-item">
                                                        <img src="{{ photo_url }}" 
                                                             alt="{{ a.kitchenAppliances }} in {{ r.roomType }}" 
                                                             loading="lazy"
                                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                                      
                                                    </figure>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}
                {% endfor %}
            {% endif %}

            <!-- External Surfaces - Only show if data exists -->
            {% if property.externalSurfaces and property.externalSurfaces|length > 0 %}
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-house-exclamation"></i>
                    </div>
                    External Surfaces
                    <span class="badge-count">{{ property.externalSurfaces|length }}</span>
                </div>
                <div class="section-body">
                    {% for s in property.externalSurfaces %}
                    <div class="component-container">
                        <div class="component-details">
                            <div class="details-grid">
                                <div class="detail-item">
                                    <div class="detail-item-label">Location</div>
                                    <div class="detail-item-value">{{ s.location }}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">Type</div>
                                    <div class="detail-item-value">{{ s.externalSurfaceType }}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">Condition</div>
                                    <div class="detail-item-value">{{ s.condition }}</div>
                                </div>
                                {% if s.notes %}
                                <div class="detail-item">
                                    <div class="detail-item-label">Notes</div>
                                    <div class="detail-item-value">{{ s.notes }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="component-photos">
                            <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                            {% if s.photo %}
                                <div class="photo-gallery">
                                    {% for photo_url in s.photo %}
                                    <figure class="photo-item">
                                        <img src="{{ photo_url }}" 
                                             alt="{{ s.externalSurfaceType }} at {{ s.location }}" 
                                             loading="lazy"
                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                        
                                    </figure>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- External Features - Only show if data exists -->
            {% if property.externalFeatures and property.externalFeatures|length > 0 %}
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-tree"></i>
                    </div>
                    External Features
                    <span class="badge-count">{{ property.externalFeatures|length }}</span>
                </div>
                <div class="section-body">
                    {% for f in property.externalFeatures %}
                    <div class="component-container">
                        <div class="component-details">
                            <div class="details-grid">
                                <div class="detail-item">
                                    <div class="detail-item-label">Feature</div>
                                    <div class="detail-item-value">{{ f.externalFeature }}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">Condition</div>
                                    <div class="detail-item-value">{{ f.condition }}</div>
                                </div>
                                {% if f.notes %}
                                <div class="detail-item">
                                    <div class="detail-item-label">Notes</div>
                                    <div class="detail-item-value">{{ f.notes }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="component-photos">
                            <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                            {% if f.photo %}
                                <div class="photo-gallery">
                                    {% for photo_url in f.photo %}
                                    <figure class="photo-item">
                                        <img src="{{ photo_url }}" 
                                             alt="{{ f.externalFeature }}" 
                                             loading="lazy"
                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                        
                                    </figure>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Boundaries - Only show if data exists -->
            {% if property.boundary and property.boundary|length > 0 %}
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-fence"></i>
                    </div>
                    Boundaries
                    <span class="badge-count">{{ property.boundary|length }}</span>
                </div>
                <div class="section-body">
                    {% for b in property.boundary %}
                    <div class="component-container">
                        <div class="component-details">
                            <div class="details-grid">
                                <div class="detail-item">
                                    <div class="detail-item-label">Type</div>
                                    <div class="detail-item-value">{{ b.boundaryType }}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">Color</div>
                                    <div class="detail-item-value">{{ b.colour }}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">Condition</div>
                                    <div class="detail-item-value">{{ b.condition }}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">Quantity</div>
                                    <div class="detail-item-value">{{ b.quantity }}</div>
                                </div>
                                {% if b.notes %}
                                <div class="detail-item">
                                    <div class="detail-item-label">Notes</div>
                                    <div class="detail-item-value">{{ b.notes }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="component-photos">
                            <div class="component-title"><i class="bi bi-image"></i> Photos</div>
                            {% if b.photo %}
                                <div class="photo-gallery">
                                    {% for photo_url in b.photo %}
                                    <figure class="photo-item">
                                        <img src="{{ photo_url }}" 
                                             alt="{{ b.boundaryType }}" 
                                             loading="lazy"
                                             onerror="this.onerror=null; this.parentElement.classList.add('image-error');">
                                       
                                    </figure>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-muted mb-0"><i class="bi bi-image"></i> No photos</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Signature Section (Improved) -->
            <div class="signature-section">
                <h4 class="signature-header">
                    <i class="bi bi-pen me-2"></i>
                    Signatures
                </h4>

                <!-- Explanation box (inspired by image) -->
                <div class="signature-meaning">
                    <span class="signature-meaning-icon">①</span>
                    <div class="signature-meaning-text">
                        <strong>What This Signature Means:</strong> By signing this document, you are confirming that you have reviewed this property inventory report and agree that the condition, contents, and details documented here are accurate. This protects both the landlord and tenant by providing a legally binding record of the property's condition at the start of the tenancy.
                    </div>
                </div>

                <hr class="signature-divider">

                <div class="signature-container">
                    <!-- Landlord/Agent Signature -->
                    <div class="signature-box">
                        <h5 class="signature-box-title">Landlord/Agent Signature</h5>
                        <canvas class="signature-pad" id="landlord-signature-pad"></canvas>
                        <div class="signature-actions">
                            <button class="btn btn-sm btn-outline-secondary" id="landlord-clear">Clear</button>
                            <button class="btn btn-sm btn-outline-primary" id="landlord-save">Save Signature</button>
                        </div>
                        <div class="signature-name-line">
                            <span class="signature-label">Landlord / Agent:</span>
                            <span class="signature-line">_________________________</span>
                        </div>
                        <div class="signature-date-line">
                            <span class="signature-label">Date:</span>
                            <span class="signature-date" id="landlord-date"></span>
                        </div>
                    </div>

                    <!-- Tenant Signature -->
                    <div class="signature-box">
                        <h5 class="signature-box-title">Tenant Signature</h5>
                        <canvas class="signature-pad" id="tenant-signature-pad"></canvas>
                        <div class="signature-actions">
                            <button class="btn btn-sm btn-outline-secondary" id="tenant-clear">Clear</button>
                            <button class="btn btn-sm btn-outline-primary" id="tenant-save">Save Signature</button>
                        </div>
                        <div class="signature-name-line">
                            <span class="signature-label">Tenant:</span>
                            <span class="signature-line">_________________________</span>
                        </div>
                        <div class="signature-date-line">
                            <span class="signature-label">Date:</span>
                            <span class="signature-date" id="tenant-date"></span>
                        </div>
                    </div>
                </div>

                <div class="signature-footer-note">
                    <i class="bi bi-info-circle me-2"></i>
                    By signing above, you acknowledge that you have reviewed and agree with the contents of this property inventory report.
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                <div class="d-flex align-items-center justify-content-center mb-2">
                    <div class="bg-primary rounded-circle p-2 me-3"></div>
                    <div class="bg-info rounded-circle p-2 me-3"></div>
                    <div class="bg-success rounded-circle p-2"></div>
                </div>
                <div class="small">Property Full Report • Generated on {{ now|date:"M j, Y" }}</div>
            </div>
            
            </div> <!-- /.post-summary-sections -->
        </div> <!-- /.p-4.p-lg-5 -->
    </div> <!-- /.report-container -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Elements (canvas)
      let landlordCanvas = document.getElementById('landlord-signature-pad');
      let tenantCanvas = document.getElementById('tenant-signature-pad');

      // Helper: set canvas pixel size for high-DPI and preserve drawing when needed
      function setCanvasDisplaySize(canvas) {
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        // set the internal pixel size to match display size * ratio
        canvas.width = Math.floor(canvas.offsetWidth * ratio);
        canvas.height = Math.floor(canvas.offsetHeight * ratio);
        // scale drawing operations to account for ratio
        canvas.getContext('2d').setTransform(ratio, 0, 0, ratio, 0, 0);
      }

      // Initial sizing BEFORE creating SignaturePad
      setCanvasDisplaySize(landlordCanvas);
      setCanvasDisplaySize(tenantCanvas);

      // Create SignaturePad instances
      const landlordSignaturePad = new SignaturePad(landlordCanvas, {
        backgroundColor: 'rgb(255, 255, 255)',
        penColor: 'rgb(0, 0, 0)'
      });

      const tenantSignaturePad = new SignaturePad(tenantCanvas, {
        backgroundColor: 'rgb(255, 255, 255)',
        penColor: 'rgb(0, 0, 0)'
      });

      // Clear buttons
      document.getElementById('landlord-clear').addEventListener('click', function() {
        landlordSignaturePad.clear();
        document.getElementById('landlord-date').textContent = '';
      });

      document.getElementById('tenant-clear').addEventListener('click', function() {
        tenantSignaturePad.clear();
        document.getElementById('tenant-date').textContent = '';
      });

      // Save buttons
      document.getElementById('landlord-save').addEventListener('click', function() {
        if (landlordSignaturePad.isEmpty()) {
          alert("Please provide a signature first.");
          return;
        }
        const today = new Date().toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
        document.getElementById('landlord-date').textContent = today;
        // Optionally store signature data in a hidden field here
      });

      document.getElementById('tenant-save').addEventListener('click', function() {
        if (tenantSignaturePad.isEmpty()) {
          alert("Please provide a signature first.");
          return;
        }
        const today = new Date().toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
        document.getElementById('tenant-date').textContent = today;
      });

      // Preserve drawing on resize: save dataURL, resize, then re-load
      window.addEventListener('resize', function() {
        // landlord
        const landlordData = landlordSignaturePad.isEmpty() ? null : landlordSignaturePad.toDataURL();
        setCanvasDisplaySize(landlordCanvas);
        landlordSignaturePad.clear();
        if (landlordData) landlordSignaturePad.fromDataURL(landlordData);

        // tenant
        const tenantData = tenantSignaturePad.isEmpty() ? null : tenantSignaturePad.toDataURL();
        setCanvasDisplaySize(tenantCanvas);
        tenantSignaturePad.clear();
        if (tenantData) tenantSignaturePad.fromDataURL(tenantData);
      });
      
      // Image error handling enhancement
      document.querySelectorAll('img').forEach(img => {
          img.addEventListener('error', function() {
              if (!this.parentElement.classList.contains('image-error')) {
                  this.parentElement.classList.add('image-error');
                  this.style.display = 'none';
                  const errorDiv = document.createElement('div');
                  errorDiv.className = 'image-error';
                  errorDiv.innerHTML = '<i class="bi bi-image"></i><div>Image not available</div>';
                  this.parentElement.appendChild(errorDiv);
              }
          });
          
          // Show loading state
          img.addEventListener('load', function() {
              this.parentElement.classList.remove('image-loading');
          });
          
          // Add loading class initially
          if (!img.complete) {
              img.parentElement.classList.add('image-loading');
          }
      });
    });

    // Download report as PDF via backend
    function downloadReport() {
      try {
        const url = window.location.pathname.replace('/report/', '/report/download/');
        window.location.href = url;
      } catch(e) {
        console.error('Download error:', e);
        alert('Error downloading report. Please try again.');
      }
      return false;
    }
    </script>
</body>
</html>